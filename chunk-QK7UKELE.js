import{a as o}from"./chunk-OKUSBOD6.js";import{a as S}from"./chunk-X6HEQ5CT.js";import{a as y}from"./chunk-P6OX5KW3.js";import{e as p,j as h,l as f}from"./chunk-7PAKQCDZ.js";import{a as v}from"./chunk-TWUZI4X4.js";import{d,g}from"./chunk-WOQCCJWR.js";import{$a as u,J as n,a as s,aa as i,fb as c,fc as m,pa as l}from"./chunk-QEG7R3DB.js";var I=class a{authenticationService=i(o);toastService=i(v);userService=i(f);renderer=i(u);routeQueryParams=i(d).snapshot.queryParams;router=i(g);currentTheme=i(S).currentTheme;loginMethod=l(null);ngAfterViewInit(){typeof google<"u"?this.googleInitializeHandler():h(p,this.renderer,r=>{if(r){this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:"\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0628\u062C\u0648\u062C\u0644\u060C \u064A\u0631\u062C\u0649 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0623\u062E\u0631\u0649"});return}this.googleInitializeHandler()},!0)}googleInitializeHandler(){google.accounts.id.initialize({client_id:y.googleClientId,callback:r=>{if(this.loginMethod())return;this.loginMethod.set("social");let t=this.decodeGoogleJwt(r.credential);this.authenticationService.socialLogin({UserId:t.sub,Provider:"Google",FirstName:t.given_name,LastName:t.family_name,EmailAddress:t.email,PictureUrl:t.picture,OauthToken:r.credential,IsStudent:!0}).pipe(n(()=>this.loginMethod.set(null))).subscribe({next:e=>{if(e.code===200){if(!e.user.isActive){this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0645\u062A\u0648\u0642\u0641 \u0628\u0631\u062C\u0627\u0621 \u0627\u0644\u062A\u0648\u0627\u0635\u0644 \u0645\u0639 \u0627\u0644\u0627\u062F\u0627\u0631\u0629"});return}localStorage.setItem("courssat-user-token",e.token),localStorage.setItem("courssat-user-id",e.user.id),this.userService.setUser(e.user),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0628\u0646\u062C\u0627\u062D",message:`\u0645\u0631\u062D\u0628\u0627 ${e.user.firstName+(e.user.familyName&&e.user.firstName!==e.user.familyName)?" "+e.user.familyName:""}`}),this.routeQueryParams.redirectURL?this.router.navigateByUrl(this.routeQueryParams.redirectURL,s({replaceUrl:!0},this.routeQueryParams.applyCoupon&&{queryParams:{applyCoupon:this.routeQueryParams.applyCoupon}})):this.router.navigateByUrl("/",{replaceUrl:!0})}else this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message_AR??"\u0641\u0634\u0644 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644\u060C \u064A\u0631\u062C\u0649 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0623\u062E\u0631\u0649"})},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}})},auto_select:!1,cancel_on_tap_outside:!0}),google.accounts.id.renderButton(document.getElementById("googleBtn"),{theme:this.currentTheme()==="dark"?"outline":"filled_blue",size:"large",width:"100%"})}decodeGoogleJwt(r){let e=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(atob(e))}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=c({type:a,selectors:[["app-social-auth"]],features:[m([o])],decls:0,vars:0,template:function(t,e){},encapsulation:2})};export{I as a};
