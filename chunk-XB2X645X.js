import{a as wt}from"./chunk-7QEYKEKV.js";import{a as ht}from"./chunk-5BA7HGMY.js";import{a as _t,b as bt}from"./chunk-XSJT4XQ5.js";import{a as Z}from"./chunk-UQZZIWYK.js";import{a as Ct}from"./chunk-5LBLQR7I.js";import{a as Pe}from"./chunk-SEHUKUSY.js";import{a as me,b as st,c as pe,d as at,e as lt,f as Y,g as ut,h as ct,i as dt,j as mt,k as pt,l as vt,m as ft,o as ve}from"./chunk-W4TJDPBM.js";import{a as Ee,b as yt}from"./chunk-3XSZFALT.js";import{a as xt}from"./chunk-YJRBJEMI.js";import{a as fe}from"./chunk-KI76VGTE.js";import{a as gt}from"./chunk-BNCCPNSP.js";import"./chunk-P6OX5KW3.js";import{e as de,g as te,k as z}from"./chunk-NLB5HRRX.js";import{a as Q}from"./chunk-5I5XZVIT.js";import{c as nt,d as rt,g as ce}from"./chunk-5NPNKZ3O.js";import{g as it,h as ot}from"./chunk-VE6ZJ4JM.js";import{$a as oe,$b as Je,Ab as R,Bb as B,Cb as We,Db as ze,E as Le,Fb as D,Gb as Ge,J,Jb as w,Kb as Ze,Lb as d,N as Ne,O as Fe,Oa as Be,Pa as Oe,Qa as He,R as ie,Sa as r,T as Ve,Vb as j,Wb as F,Xb as l,Ya as je,Yb as S,Zb as I,_b as Ke,a as h,aa as f,ab as ne,ac as Ye,b as y,bc as se,cc as ee,dc as G,fa as _,fb as P,fc as ae,ga as b,gc as De,hb as $e,hc as le,ib as re,ic as $,jc as Qe,ka as Ae,kc as O,la as Ue,lc as Xe,mc as W,o as Re,pa as U,qb as p,rb as v,sb as N,sc as et,t as ke,tb as T,tc as ue,ub as L,va as qe,vb as C,vc as V,wb as s,wc as u,xb as a,yb as c,yc as tt,z as Me,zb as E}from"./chunk-VRT4WXDD.js";var St=(i,t)=>({"font-saudi-riyal":i,"text-lg":t});function Rt(i,t){if(i&1&&(s(0,"div",10)(1,"span",17),l(2),a()()),i&2){let e=d(3);r(2),S(e.coursePaymentLabel())}}function kt(i,t){if(i&1&&(s(0,"span",15),l(1),O(2,"number"),s(3,"span"),l(4),a()()),i&2){let e=d(3);r(),S(W(2,4,e.originalPrice()*e.currency.value,"1.0-0")),r(2),F($(7,St,e.isSaudi,e.isSaudi)),r(),S(e.currency.code)}}function Mt(i,t){if(i&1){let e=D();s(0,"button",18),w("click",function(){_(e);let o=d(3);return b(o.addToCart.emit())}),l(1," \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u064A \u0633\u0644\u0629 \u0627\u0644\u0645\u0634\u062A\u0631\u064A\u0627\u062A "),a()}}function Nt(i,t){i&1&&c(0,"span",25)}function Ft(i,t){i&1&&c(0,"span",25)}function Vt(i,t){if(i&1){let e=D();s(0,"div",19)(1,"label",20),c(2,"span",21)(3,"input",26),a(),c(4,"div",23),s(5,"button",24),w("click",function(){_(e);let o=d(4);return b(o.payAsYouWantHandler())}),s(6,"span"),l(7,"\u062A\u0639\u062F\u064A\u0644"),a(),p(8,Ft,1,0,"span",25),a()()}if(i&2){let e=d(4);r(3),C("formControl",e.customPrice),r(2),C("disabled",!e.customPrice.value||e.currentLoading()==="apply-min-price"),r(3),v(e.currentLoading()==="apply-min-price"?8:-1)}}function At(i,t){if(i&1){let e=D();s(0,"div",19)(1,"label",20),c(2,"span",21)(3,"input",22),a(),c(4,"div",23),s(5,"button",24),w("click",function(){_(e);let o=d(3);return b(o.applyCouponHandler())}),s(6,"span"),l(7),a(),p(8,Nt,1,0,"span",25),a()(),p(9,Vt,9,3,"div",19)}if(i&2){let e,n=d(3);r(3),C("formControl",n.couponCode)("readOnly",!!n.coupon()),r(2),C("disabled",!n.couponCode.value||n.currentLoading()==="apply-coupon"),r(2),S(n.coupon()?"\u0627\u0644\u063A\u0627\u0621":"\u062A\u0641\u0639\u064A\u0644"),r(),v(n.currentLoading()==="apply-coupon"?8:-1),r(),v(((e=n.coupon())==null?null:e.coboneType)==2?9:-1)}}function Ut(i,t){if(i&1){let e=D();s(0,"div",9),p(1,Rt,3,1,"div",10),s(2,"div",11)(3,"button",12),w("click",function(){_(e);let o=d(2);return b(o.purchaseCourseHandler())}),s(4,"span",13),l(5),a(),s(6,"span",14),l(7),O(8,"number"),s(9,"span"),l(10),a()(),p(11,kt,5,10,"span",15),a(),p(12,Mt,2,0,"button",16),a(),p(13,At,10,6),a()}if(i&2){let e=d(2);r(),v(e.coursePaymentLabel()&&!e.user()?1:-1),r(4),S(e.user()?"\u0634\u0631\u0627\u0621 \u0627\u0644\u0622\u0646":"\u0633\u062C\u0644 \u0627\u0644\u0627\u0646"),r(2),S(W(8,9,(e.discountPrice()||e.originalPrice())*e.currency.value,"1.0-0")),r(2),F($(12,St,e.isSaudi,e.isSaudi)),r(),S(e.currency.code),r(),v(e.discountPrice()<e.originalPrice()?11:-1),r(),v(e.user()&&!e.courseRedirectUrl()?12:-1),r(),v(e.user()&&!e.courseRedirectUrl()?13:-1)}}function qt(i,t){if(i&1&&(s(0,"div",31),l(1),a()),i&2){let e=t.$implicit;r(),I(" ",e.name," ")}}function Bt(i,t){if(i&1&&(s(0,"div",27)(1,"h4",28),l(2),a(),s(3,"p",29),l(4),a()(),s(5,"div",27)(6,"h4",28),l(7,"KeyWords"),a(),s(8,"div",30),T(9,qt,2,1,"div",31,N),a()()),i&2){let e=d(2);r(2),S(e.instructorName()),r(2),I(" ",e.instructorBrief()," "),r(5),L(e.keywords())}}function Ot(i,t){if(i&1&&(s(0,"ul",1)(1,"li",2),c(2,"span",3),s(3,"span",4),l(4,"\u0639\u062F\u062F \u0627\u0644\u062F\u0631\u0648\u0633"),a(),s(5,"span",5),l(6),a()(),s(7,"li",2),c(8,"span",6),s(9,"span",4),l(10,"\u0639\u062F\u062F \u0627\u0644\u0633\u0627\u0639\u0627\u062A"),a(),s(11,"span",5),l(12),a()(),s(13,"li",7),c(14,"span",8),s(15,"span",4),l(16,"\u0627\u0644\u0637\u0644\u0627\u0628 \u0627\u0644\u0645\u0633\u062C\u0644\u064A\u0646"),a(),s(17,"span",5),l(18),a()()(),p(19,Ut,14,15,"div",9),p(20,Bt,11,2)),i&2){let e,n=d();r(6),I("",n.lessonCount()," \u062F\u0631\u0633\u0627\u064B"),r(6),I("",n.hourCount()," \u0633\u0627\u0639\u0647"),r(6),I("",n.studentsCount()," \u0637\u0627\u0644\u0628"),r(),v(n.isPaid()||((e=n.user())==null?null:e.roleType)==1||n.instructorId()==((e=n.user())==null?null:e.id)?-1:19),r(),v(n.isMobile?-1:20)}}function Ht(i,t){i&1&&(s(0,"div",32),c(1,"div",39)(2,"div",40)(3,"div",40)(4,"div",40)(5,"div",34),a(),s(6,"div",32),c(7,"div",39),s(8,"div",30),c(9,"div",41)(10,"div",42)(11,"div",42)(12,"div",41),a()())}function jt(i,t){if(i&1&&(s(0,"div",32),c(1,"div",33)(2,"div",33)(3,"div",34),a(),s(4,"div")(5,"div",35),c(6,"div",36)(7,"div",37),a(),c(8,"div",38),a(),p(9,Ht,13,0)),i&2){let e=d();r(9),v(e.isMobile?-1:9)}}var ge=class i{user=f(z).user;router=f(ce);currency=f(de).currency();couponService=f(Pe);courseService=f(Z);toastService=f(Q);cart=f(fe).cart;isMobile=matchMedia("(width <= 640px)").matches;discountPrice=u.required();originalPrice=u.required();hourCount=u.required();courseLoading=u.required();lessonCount=u.required();studentsCount=u.required();instructorBrief=u();coupon=u();courseId=u.required();courseName=u.required();courseImg=u.required();courseRedirectUrl=u();coursePaymentLabel=u();instructorName=u.required();keywords=u.required();isPaid=u.required();instructorId=u.required();isSaudi=te()=="SA";addToCart=V();applyCoupon=V();changePrice=V();couponCode=new Y("",{nonNullable:!0});customPrice=new Y("",{nonNullable:!0});currentLoading=U(null);applyCouponHandler(){if(this.coupon()){this.applyCoupon.emit(null);return}!this.currentLoading()&&this.couponCode.value&&(this.currentLoading.set("apply-coupon"),this.couponService.applyCoupon(this.couponCode.value,this.courseId()).pipe(ie(t=>this.couponService.saveCoupon({student_email:this.user().email,student_name:this.user().firstName,code:this.couponCode.value,course_id:this.courseId().toString(),course_name:this.courseName()}).pipe(ke(()=>t),Le(()=>Re(t)))),Le(()=>this.couponService.applyCoupon(this.couponCode.value))).subscribe({next:t=>{this.currentLoading.set(null),t.courseId===null&&t.id==this.cart().coupon?.id?this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0645\u0633\u062A\u062E\u062F\u0645 \u0628\u0627\u0644\u0641\u0639\u0644 \u0641\u0649 \u0627\u0644\u0633\u0644\u0647"}):this.cart().coupon?.id&&this.cart().items.find(e=>e.id==this.courseId())?this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0627\u0644\u0643\u0648\u0631\u0633 \u0645\u0648\u062C\u0648\u062F \u0641\u0649 \u0627\u0644\u0633\u0644\u0647 \u0648\u0639\u0644\u064A\u0647 \u0643\u0648\u0628\u0648\u0646 \u0628\u0627\u0644\u0641\u0639\u0644"}):this.applyCoupon.emit(t)},error:t=>{this.currentLoading.set(null),this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:t.message==="This Copon is expired or not suitable with this course"?"\u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u063A\u064A\u0631 \u0635\u0627\u0644\u062D":t.message})}}))}purchaseCourseHandler(){if(this.courseRedirectUrl()){window.open(this.courseRedirectUrl());return}this.user()?document.getElementById("courssat_checkout_modal")?.showModal():this.router.navigate(["auth","login"],{queryParams:{redirectURL:this.router.url}})}payAsYouWantHandler(){this.customPrice.value&&+this.customPrice.value>1&&!this.currentLoading()&&(this.currentLoading.set("apply-min-price"),this.courseService.payAsyouWantMinPrice().pipe(J(()=>this.currentLoading.set(null))).subscribe({next:({min_price:t})=>{let e=+this.customPrice.value/this.currency.value;e<t?this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:`\u0627\u0644\u062D\u062F \u0627\u0644\u0627\u062F\u0646\u064A \u0644\u0644\u0633\u0639\u0631 ${Math.ceil(t*this.currency.value)+" "+this.currency.code}`}):(this.changePrice.emit(e),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u062A\u0639\u062F\u064A\u0644 \u0633\u0639\u0631 \u0627\u0644\u0643\u0648\u0631\u0633 \u0628\u0646\u062C\u0627\u062D"}))},error:t=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:t.message})}}))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-sidebar"]],inputs:{discountPrice:[1,"discountPrice"],originalPrice:[1,"originalPrice"],hourCount:[1,"hourCount"],courseLoading:[1,"courseLoading"],lessonCount:[1,"lessonCount"],studentsCount:[1,"studentsCount"],instructorBrief:[1,"instructorBrief"],coupon:[1,"coupon"],courseId:[1,"courseId"],courseName:[1,"courseName"],courseImg:[1,"courseImg"],courseRedirectUrl:[1,"courseRedirectUrl"],coursePaymentLabel:[1,"coursePaymentLabel"],instructorName:[1,"instructorName"],keywords:[1,"keywords"],isPaid:[1,"isPaid"],instructorId:[1,"instructorId"]},outputs:{addToCart:"addToCart",applyCoupon:"applyCoupon",changePrice:"changePrice"},features:[ae([Pe])],decls:3,vars:1,consts:[[1,"flex","flex-col","gap-6","lg:gap-10"],[1,"list-none","px-6","py-4","border","border-dashed","rounded-sm"],[1,"flex","items-center","gap-2","mb-4"],[1,"iconify","solar--alarm-play-broken","text-secondary","text-2xl"],[1,"flex-1","text-base-content"],[1,"text-body-5","font-bold"],[1,"iconify","solar--clock-circle-broken","text-secondary","text-2xl"],[1,"flex","items-center","gap-2"],[1,"iconify","solar--user-rounded-broken","text-secondary","text-2xl"],[1,"flex","flex-col","gap-4"],["role","alert",1,"alert","alert-info","alert-soft","rounded-sm"],[1,"flex","flex-wrap","gap-4"],[1,"btn","px-2","lg:px-5","lg:btn-lg","lg:w-full","btn-primary",3,"click"],[1,"font-bold"],[1,"text-secondary","font-bold"],[1,"text-sm","text-base-content","line-through","font-light"],[1,"btn","px-2","lg:px-5","lg:btn-lg","flex-1","bg-base-500","border-dashed","border-primary","text-primary","w-full"],[1,"text-justify"],[1,"btn","px-2","lg:px-5","lg:btn-lg","flex-1","bg-base-500","border-dashed","border-primary","text-primary","w-full",3,"click"],[1,"py-1","px-4","flex","gap-7","bg-neutral"],[1,"input","bg-transparent","border-none","shadow-none","outline-none"],[1,"iconify","hugeicons--coupon-01","text-2xl","text-base-content"],["type","text","placeholder","\u0623\u062F\u062E\u0644 \u0631\u0645\u0632 \u0627\u0644\u0643\u0648\u0628\u0648\u0646",1,"text-base-content","placeholder:text-base-content","placeholder:opacity-50",3,"formControl","readOnly"],[1,"border-r","border-dashed","border-base-content"],[1,"btn","btn-link","text-secondary","px-0","no-underline",3,"click","disabled"],[1,"loading","loading-ring","text-secondary"],["type","number","placeholder","\u0627\u062F\u0641\u0639 \u0643\u0645\u0627 \u062A\u0631\u064A\u062F","min","1",1,"text-base-content","placeholder:text-base-content","placeholder:opacity-50",3,"formControl"],[1,"p-4","border","border-dashed","rounded-sm"],[1,"lg:text-xl","text-body-5","font-bold","mb-4"],[1,"text-sm","lg:text-base","text-base-content"],[1,"flex","flex-wrap","gap-3"],[1,"p-2","text-sm","lg:text-base","rounded-sm","text-secondary","bg-secondary-5"],[1,"mb-4"],[1,"skeleton","w-full","h-6","mb-4"],[1,"skeleton","w-full","h-6"],[1,"flex","flex-wrap","mb-4","gap-4"],[1,"skeleton","h-10","w-2/5","lg:h-12","lg:w-full"],[1,"skeleton","flex-1","h-10","lg:h-12"],[1,"skeleton","w-full","h-10"],[1,"skeleton","w-1/2","h-7","mb-4"],[1,"skeleton","w-full","h-6","mb-2"],[1,"skeleton","w-1/3","h-10"],[1,"skeleton","w-1/2","h-10"]],template:function(e,n){e&1&&(s(0,"div",0),p(1,Ot,21,5)(2,jt,10,1),a()),e&2&&(r(),v(n.courseLoading()?2:1))},dependencies:[ve,me,ct,pe,vt,dt,ot],encapsulation:2,changeDetection:0})};function $t(i,t){i&1&&(s(0,"h2",1),l(1," \u0627\u0644\u0643\u0648\u0631\u0633\u0627\u062A "),s(2,"span",6),l(3," \u0630\u0627\u062A \u0627\u0644\u0635\u0644\u0629"),a()())}function Wt(i,t){i&1&&c(0,"div",2)}function zt(i,t){if(i&1&&c(0,"app-course-card",4),i&2){let e=t.$implicit;C("course",e)}}function Gt(i,t){i&1&&(s(0,"div",5)(1,"span"),l(2,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0643\u0648\u0631\u0633\u0627\u062A \u062C\u062F\u064A\u062F\u0629 \u062D\u0627\u0644\u064A\u0627\u064B."),a()())}var Ce=class i{courses=u.required();courseLoading=u.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-related-courses"]],inputs:{courses:[1,"courses"],courseLoading:[1,"courseLoading"]},decls:7,vars:2,consts:[[1,"pt-4","pb-14","lg:pb-24"],[1,"text-2xl","lg:text-4xl","text-center","lg:text-start","xl:text-[45px]","font-bold","text-primary","mb-6","lg:mb-8"],[1,"skeleton","w-full","lg:w-1/3","h-8","lg:h-14","mb-6"],[1,"grid","grid-cols-2","lg:grid-cols-4","gap-2.5","lg:gap-5"],[3,"course"],["role","alert",1,"col-span-4","alert","alert-info","justify-center","alert-soft"],[1,"text-secondary"]],template:function(e,n){e&1&&(s(0,"section",0),p(1,$t,4,0,"h2",1)(2,Wt,1,0,"div",2),s(3,"div",3),T(4,zt,1,1,"app-course-card",4,N,!1,Gt,3,0,"div",5),a()()),e&2&&(r(),v(n.courseLoading()?2:1),r(3),L(n.courses()))},dependencies:[Ct],encapsulation:2,changeDetection:0})};var _e=class i{constructor(t,e,n){this.EleRef=t;this.renderer=e;this.ngZone=n;ue(()=>{if(["youtu","iframe.mediadelivery.net"].some(o=>this.videoSrc()?.includes(o))){if(this.videoSrc()?.includes("iframe.mediadelivery.net"))if(this.bunnyPlayer)this.bunnyPlayer.off("ended"),new Promise(o=>{let m=setTimeout(()=>{o(m)},2e3)}).then(o=>{clearTimeout(o),this.bunnyPlayer.on("ended",()=>this.videoEnd.emit())});else if(typeof playerjs>"u"){let o=e.createElement("script");e.setAttribute(o,"src","bunny-player.js"),e.setAttribute(o,"defer","true"),e.listen(o,"load",this.loadBunnyPlayer.bind(this,!1)),e.appendChild(document.body,o)}else this.loadBunnyPlayer()}else if(this.vimeoPlayer)this.vimeoPlayer.off("ended"),new Promise(o=>{let m=setTimeout(()=>{o(m)},1e3)}).then(o=>{clearTimeout(o),this.vimeoPlayer.on("ended",()=>this.videoEnd.emit())});else if(typeof Vimeo>"u"){let o=this.renderer.createElement("script");this.renderer.setAttribute(o,"src","vimeo-player.js"),this.renderer.setAttribute(o,"defer","true"),this.renderer.listen(o,"load",this.loadVimeoPlayer.bind(this,!1)),this.renderer.appendChild(document.body,o)}else this.loadVimeoPlayer()})}videoSrc=u.required({alias:"data-src"});vimeoPlayer;bunnyPlayer;videoEnd=V();loadBunnyPlayer(t=!1){this.videoSrc()&&typeof playerjs<"u"&&this.ngZone.runOutsideAngular(()=>{let e=new playerjs.Player(this.EleRef.nativeElement);e.on("ready",()=>{e.on("ended",()=>this.videoEnd.emit()),t&&e.play()}),this.ngZone.run(()=>{this.bunnyPlayer=e})})}loadVimeoPlayer(t=!1){this.videoSrc()&&typeof Vimeo<"u"&&this.ngZone.runOutsideAngular(()=>{let e=new Vimeo.Player(this.EleRef.nativeElement);t&&e.play().catch(console.log),e.on("ended",()=>this.videoEnd.emit()),this.ngZone.run(()=>{this.vimeoPlayer=e})})}static \u0275fac=function(e){return new(e||i)(ne(qe),ne(oe),ne(je))};static \u0275dir=$e({type:i,selectors:[["","appCourssatVideo",""]],inputs:{videoSrc:[1,"data-src","videoSrc"]},outputs:{videoEnd:"videoEnd"}})};var be=class i{sanitizer=f(nt);transform(t,e){return t&&(t?.includes("mediadelivery")?t=t.replace("play","embed")+(e?"?autoplay=true&enableApi=true":"?api=true&playerId=bunny123"):t?.includes("youtube")?t="https://www.youtube.com/embed/"+t.split("?v=")[1].split("&")[0]+(e?"?autoplay=true":""):t="https://player.vimeo.com/video/"+t?.replace("https://vimeo.com/","")+(e?"?autoplay=1&portrait=false":"")),this.sanitizer.bypassSecurityTrustResourceUrl(t??"")}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=re({name:"safeUrl",type:i,pure:!0})};function Zt(i,t){if(i&1){let e=D();s(0,"iframe",4),O(1,"safeUrl"),w("videoEnd",function(){_(e);let o=d();return b(o.videoEndHandler())}),a()}if(i&2){let e,n,o=d();C("src",W(1,2,(e=o.activeLesson())==null?null:e.videoUrl,(e=o.activeLesson())==null?null:e.autoplay),He)("data-src",(n=o.activeLesson())==null?null:n.videoUrl)}}function Kt(i,t){i&1&&c(0,"div",2)}function Jt(i,t){if(i&1){let e=D();s(0,"h2",5),l(1),a(),s(2,"button",6),w("click",function(){_(e);let o=d();return b(o.toggleFavCourse.emit())}),c(3,"span",7),a()}if(i&2){let e=d();r(),S(e.title()),r(),j("bg-secondary",e.isFavourite())}}function Yt(i,t){i&1&&c(0,"div",8)(1,"div",9)}var xe=class i{title=u.required();isFavourite=u.required();courseLoading=u.required();nextVideo=V();toggleFavCourse=V();renderer=f(oe);document=f(Ae);activeLesson=u.required();videoEndHandler(){this.nextVideo.emit(this.activeLesson())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-video"]],inputs:{title:[1,"title"],isFavourite:[1,"isFavourite"],courseLoading:[1,"courseLoading"],activeLesson:[1,"activeLesson"]},outputs:{nextVideo:"nextVideo",toggleFavCourse:"toggleFavCourse"},decls:7,vars:2,consts:[[1,"aspect-video","mb-6","rounded-sm","overflow-hidden"],["id","courssat-video-iframe","appCourssatVideo","","width","100%","height","100%","frameborder","0","allowfullscreen","","allow","autoplay;picture-in-picture;fullscreen",3,"src","data-src"],[1,"skeleton","w-full","h-full"],[1,"flex","items-center","justify-between","gap-4","mb-8"],["id","courssat-video-iframe","appCourssatVideo","","width","100%","height","100%","frameborder","0","allowfullscreen","","allow","autoplay;picture-in-picture;fullscreen",3,"videoEnd","src","data-src"],[1,"text-xl","lg:text-3xl","xl:text-4xl","text-body-5","font-bold","flex-1"],[1,"btn","btn-circle","btn-lg","lg:btn-xl","bg-base-200","[&.bg-secondary>span]:text-white",3,"click"],[1,"iconify","solar--bookmark-broken","text-xl","text-base-content"],[1,"skeleton","w-2/3","h-8","lg:h-10"],[1,"skeleton","rounded-full","w-12","h-12","lg:w-14","lg:h-14"]],template:function(e,n){if(e&1&&(s(0,"section")(1,"div",0),p(2,Zt,2,5,"iframe",1)(3,Kt,1,0,"div",2),a(),s(4,"div",3),p(5,Jt,4,3)(6,Yt,2,0),a()()),e&2){let o=n.courseLoading();r(2),v(o?3:2),r(3),v(o?6:5)}},dependencies:[_e,be],encapsulation:2,changeDetection:0})};var Tt=()=>[1,2,3,4],Lt=(i,t)=>t.id;function Qt(i,t){if(i&1&&(E(0,"li",4),B(1,"span",5),E(2,"span",6),l(3),R()()),i&2){let e=t.$implicit;r(3),S(e.answer)}}function Xt(i,t){if(i&1&&(E(0,"h3",1),l(1),R(),E(2,"ul",3),T(3,Qt,4,1,"li",4,Lt),R()),i&2){let e=t.$implicit;r(),S(e.question),r(2),L(e.answers)}}function ei(i,t){if(i&1&&(E(0,"h3",1),l(1,"\u0648\u0635\u0641 \u0627\u0644\u0643\u0648\u0631\u0633"),R(),B(2,"p",2),T(3,Xt,5,1,null,null,Lt)),i&2){let e=d();r(2),Ge("innerHTML",e.description(),Be),r(),L(e.courseDataVMS())}}function ti(i,t){if(i&1&&B(0,"div",9),i&2){let e=t.$index,n=t.$count;j("mb-2",e!==n-1)}}function ii(i,t){if(i&1&&(B(0,"div",7),E(1,"div"),T(2,ti,1,2,"div",8,N),R()),i&2){let e=t.$index;j("w-30",e===0),r(2),L(De(2,Tt))}}function oi(i,t){i&1&&T(0,ii,4,3,null,null,N),i&2&&L(De(0,Tt))}var he=class i{description=u.required();courseLoading=u.required();courseDataVMS=u.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-overview"]],inputs:{description:[1,"description"],courseLoading:[1,"courseLoading"],courseDataVMS:[1,"courseDataVMS"]},decls:3,vars:1,consts:[[1,"flex","flex-col","gap-4","lg:gap-6"],[1,"lg:text-[22px]","font-bold","text-body-5"],[1,"text-sm","lg:text-lg","text-base-content",3,"innerHTML"],[1,"list-none"],[1,"flex","items-center","gap-4"],[1,"iconify","hugeicons--cursor-pointer-02","text-2xl","text-base-content"],[1,"text-sm","lg:text-lg","text-base-content"],[1,"skeleton","h-6","lg:h-8","w-1/3"],[1,"skeleton","h-5","lg:h-6","w-full",3,"mb-2"],[1,"skeleton","h-5","lg:h-6","w-full"]],template:function(e,n){e&1&&(E(0,"section",0),p(1,ei,5,1)(2,oi,2,1),R()),e&2&&(r(),v(n.courseLoading()?2:1))},encapsulation:2,changeDetection:0})};var ni=i=>({"border-b":i}),Dt=(i,t)=>({"bg-secondary":i,"bg-base-400":t}),ri=i=>({"text-secondary":i}),si=i=>({"cursor-pointer":i}),ai=(i,t)=>({"text-secondary":i,"group-hover:text-secondary":t}),li=(i,t)=>({"lets-icons--view":i,"si--lock-line":t}),Pt=(i,t)=>t.id;function ui(i,t){i&1&&B(0,"span",6)}function ci(i,t){i&1&&B(0,"span",6)}function di(i,t){if(i&1){let e=D();E(0,"li",10)(1,"a",11)(2,"div",5),p(3,ci,1,0,"span",6),R(),E(4,"div",12),Ze("click",function(){let o=_(e).$implicit,m=d(2),x=G(0);return b((o.public||x)&&m.setActiveLesson.emit(o.id))}),l(5),R(),B(6,"span",13),R()()}if(i&2){let e=t.$implicit;d(2);let n=G(0);r(),F(le(10,si,e.public||n)),r(),F($(12,Dt,e.isWatched||e.isActive,!e.isWatched)),r(),v(e.isWatched?3:-1),r(),F($(15,ai,e.isActive,n)),r(),I(" ",e.name_AR," "),r(),F($(18,li,e.public||n,!(e.public||n)))}}function mi(i,t){if(i&1&&(E(0,"li",2),B(1,"input",3),E(2,"div",4)(3,"div",5),p(4,ui,1,0,"span",6),R(),E(5,"div",7),l(6),R()(),E(7,"div",8)(8,"ul",9),T(9,di,7,21,"li",10,Pt),R()()()),i&2){let e=t.$implicit,n=t.$index,o=t.$count;F(le(8,ni,n!==o-1)),r(3),F($(10,Dt,e.isWatched||e.isActive,!e.isWatched)),r(),v(e.isWatched?4:-1),r(),F(le(13,ri,e.isActive)),r(),I(" ",e.topicName_AR," "),r(3),L(e.lessonList)}}var ye=class i{user=f(z).user;topics=u.required();isPaid=u.required();instructorId=u.required();setActiveLesson=V();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-content"]],inputs:{topics:[1,"topics"],isPaid:[1,"isPaid"],instructorId:[1,"instructorId"]},outputs:{setActiveLesson:"setActiveLesson"},decls:4,vars:1,consts:[[1,"list-none","bg-base-200","p-0","lg:p-6","rounded-sm"],[1,"collapse","collapse-arrow","border-dashed","border-b-base-content","rounded-none","after:border-dashed",3,"class"],[1,"collapse","collapse-arrow","border-dashed","border-b-base-content","rounded-none","after:border-dashed"],["type","checkbox"],[1,"collapse-title","flex","gap-4"],[1,"w-5","h-5","lg:w-6","lg:h-6","rounded-full","flex","items-center","justify-center"],[1,"iconify","ic--check","text-neutral","text-xl"],[1,"lg:text-xl","flex-1","text-base-content"],[1,"collapse-content","text-sm"],[1,"list"],[1,"ps-4"],[1,"list-row","after:hidden","px-0","group"],[1,"text-sm","lg:text-xl","text-base-content",3,"click"],[1,"iconify","text-2xl","text-base-content"]],template:function(e,n){if(e&1&&(se(0),E(1,"ul",0),T(2,mi,11,15,"li",1,Pt),R()),e&2){let o;ee(n.isPaid()||((o=n.user())==null?null:o.roleType)==1||n.instructorId()==((o=n.user())==null?null:o.id)),r(2),L(n.topics())}},encapsulation:2,changeDetection:0})};function pi(i,t){if(i&1&&(s(0,"div",3),c(1,"img",5),O(2,"imgUrl"),s(3,"div",6)(4,"div",7)(5,"div")(6,"h4",8),l(7),a(),c(8,"img",9),s(9,"span",10),l(10),a()(),s(11,"div",11),l(12),O(13,"date"),a()(),s(14,"p",12),l(15),a(),s(16,"button",13),l(17,"\u0631\u062F"),a()()()),i&2){let e=d().$implicit;r(),C("src",e.imageURL.startsWith("https")?e.imageURL:W(2,5,e.imageURL,"avatar"),Oe),r(6),S(e.firstName),r(3),S(e.isLike?"5":"3"),r(2),I(" ",W(13,8,e.date,"shortDate")," "),r(3),I(" ",e.evaluationComment," ")}}function vi(i,t){i&1&&(s(0,"div",4),c(1,"div",14),s(2,"div",6)(3,"div",15),c(4,"div",16)(5,"div",17),a(),c(6,"div",18)(7,"div",19),a()())}function fi(i,t){if(i&1&&p(0,pi,18,11,"div",3)(1,vi,8,0,"div",4),i&2){let e=t.$implicit;v(e?0:1)}}function gi(i,t){i&1&&(s(0,"div",1)(1,"span"),l(2,"\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u0642\u064A\u064A\u0645\u0627\u062A \u062D\u062A\u064A \u0627\u0644\u0627\u0646 \u0644\u0647\u0630\u0627 \u0627\u0644\u0643\u0648\u0631\u0633"),a()())}function Ci(i,t){i&1&&c(0,"span",33)}function _i(i,t){if(i&1){let e=D();s(0,"form",20),w("ngSubmit",function(){_(e);let o=d();return b(o.addCourseReviewHandler())}),s(1,"div",21),w("click",function(){_(e);let o=d();return b(o.isLikeReviewFormControl==null?null:o.isLikeReviewFormControl.setValue(!(o.isLikeReviewFormControl!=null&&o.isLikeReviewFormControl.value)))}),c(2,"input",22)(3,"input",23)(4,"input",24)(5,"input",25)(6,"input",26),a(),c(7,"div",27),s(8,"div",28),c(9,"img",29),s(10,"div",6),c(11,"textarea",30),s(12,"div",31),l(13,"\u0627\u0644\u062A\u0642\u064A\u064A\u0645 \u0645\u0637\u0644\u0648\u0628"),a()()(),s(14,"button",32)(15,"span"),l(16,"\u062D\u0641\u0638"),a(),p(17,Ci,1,0,"span",33),a()()}if(i&2){let e=d();C("formGroup",e.reviewForm),r(2),C("checked",!!(e.isLikeReviewFormControl!=null&&e.isLikeReviewFormControl.value)),r(),C("checked",!!(e.isLikeReviewFormControl!=null&&e.isLikeReviewFormControl.value)),r(),C("checked",!!(e.isLikeReviewFormControl!=null&&e.isLikeReviewFormControl.value)),r(),C("checked",!!(e.isLikeReviewFormControl!=null&&e.isLikeReviewFormControl.value)),r(),C("checked",!!(e.isLikeReviewFormControl!=null&&e.isLikeReviewFormControl.value)),r(11),v(e.loading()?17:-1)}}var we=class i{customCourseReviews=u();courseId=u.required();isPaid=u.required();courseReviews=U([]);courseReviewsTotalPages=U(5);loading=U(!1);courseService=f(Z);destroyRef=f(Ue);toastService=f(Q);user=f(z).user();reviewForm=new lt({isLike:new Y(!0,{nonNullable:!0}),evaluationComment:new Y("",{nonNullable:!0,validators:[st.required]})});ngOnInit(){this.customCourseReviews()?this.courseReviews.set(this.customCourseReviews()):this.getCourseReviews()}get isLikeReviewFormControl(){return this.reviewForm.get("isLike")}loadMoreReviews(t){!this.customCourseReviews()&&t.target.scrollTop+t.target.clientHeight>=t.target.scrollHeight-1&&this.courseReviews().length<this.courseReviewsTotalPages()&&this.getCourseReviews(!0)}addCourseReviewHandler(){if(!this.loading())if(this.reviewForm.valid){this.loading.set(!0);let t=y(h({id:0},this.reviewForm.getRawValue()),{userId:this.user?.id,courseId:this.courseId()});this.courseService.addCourseReview(t).pipe(J(()=>this.loading.set(!1))).subscribe({next:()=>{let e=y(h({},t),{date:new Date().toISOString(),firstName:this.user?.firstName,familyName:this.user?.familyName,imageURL:this.user?.imageURL});this.courseReviews.update(n=>[e,...n]),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u0627\u0636\u0627\u0641\u0629 \u0627\u0644\u062A\u0642\u064A\u064A\u0645 \u0628\u0646\u062C\u0627\u062D"})},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}})}else this.reviewForm.markAllAsTouched()}getCourseReviews(t=!1){this.courseReviews().find(e=>!e?.id)||(t?this.courseReviews.update(e=>[...e,...Array(5)]):this.courseReviews.set(Array(5)),this.courseService.getCourseReviews(this.courseId(),this.courseReviews().length).subscribe({next:({list:e,pagination:{total_count:n}})=>{this.courseReviews.set(e),this.courseReviewsTotalPages.set(n)},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}}))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-reviews"]],inputs:{customCourseReviews:[1,"customCourseReviews"],courseId:[1,"courseId"],isPaid:[1,"isPaid"]},decls:6,vars:4,consts:[["id","course-reviews-wrapper",1,"flex","flex-col","gap-6","mb-6","overflow-y-auto","overflow-x-hidden",3,"scroll"],["role","alert",1,"alert","justify-center","alert-info","alert-soft"],[1,"bg-base-200","rounded-sm","px-8","py-6","flex","flex-col","items-center",3,"formGroup"],[1,"bg-base-200","rounded-sm","px-4","lg:px-8","py-5","lg:py-6","flex","gap-4","lg:gap-8"],[1,"flex","gap-4","lg:gap-8"],[1,"w-9","h-9","lg:w-16","lg:h-16","rounded-full",3,"src"],[1,"flex-1"],[1,"flex","justify-between","mb-4"],[1,"text-sm","lg:text-xl","text-body-5"],["src","images/star.svg",1,"inline-block","me-3"],[1,"align-sub","text-base-content"],[1,"text-xs","lg:text-lg","text-base-content"],[1,"text-xs","lg:text-lg","text-base-content","mb-2"],[1,"lg:text-lg","underline","text-secondary","cursor-pointer"],[1,"skeleton","w-9","h-9","lg:w-16","lg:h-16","rounded-full"],[1,"flex","justify-between","mb-4","lg:mb-6"],[1,"skeleton","w-1/3","h-6","lg:h-8"],[1,"skeleton","w-1/4","h-5","lg:h-7"],[1,"skeleton","w-full","h-5","lg:h-7","mb-3"],[1,"skeleton","w-2/3","h-5","lg:h-7","mb-"],[1,"bg-base-200","rounded-sm","px-8","py-6","flex","flex-col","items-center",3,"ngSubmit","formGroup"],[1,"rating","rating-xl",3,"click"],["type","radio","aria-label","1 star",1,"mask","mask-star-2","bg-orange-400",3,"checked"],["type","radio","aria-label","2 star",1,"mask","mask-star-2","bg-orange-400",3,"checked"],["type","radio","aria-label","3 star",1,"mask","mask-star-2","bg-orange-400",3,"checked"],["type","radio","aria-label","4 star",1,"mask","mask-star-2","bg-orange-400",3,"checked"],["type","radio","aria-label","5 star",1,"mask","mask-star-2","bg-orange-400",3,"checked"],[1,"divider"],[1,"self-stretch","flex","gap-4","mb-5"],["src","images/profile.png",1,"w-16","h-16","rounded-full"],["required","","placeholder","\u0627\u0643\u062A\u0628 \u062A\u0642\u064A\u064A\u0645\u0627\u064B \u0647\u0646\u0627 ...","formControlName","evaluationComment","rows","3",1,"textarea","textarea-ghost","w-full","validator"],[1,"validator-hint"],["type","submit",1,"btn","btn-primary","px-6"],[1,"loading","loading-ring","text-white"]],template:function(e,n){if(e&1){let o=D();s(0,"section")(1,"div",0),w("scroll",function(x){return _(o),b(n.loadMoreReviews(x))}),T(2,fi,2,1,null,null,N,!1,gi,3,0,"div",1),a(),p(5,_i,18,7,"form",2),a()}if(e&2){let o=n.courseReviews();r(),j("h-125",o&&o.length>1),r(),L(o),r(3),v(n.user&&n.isPaid()?5:-1)}},dependencies:[ve,ut,me,pe,at,ft,mt,pt,it,gt],encapsulation:2,changeDetection:0})};var bi=(i,t,e)=>({"text-body-5":i,"lg:text-2xl":t,"font-bold":e});function xi(i,t){i&1&&c(0,"div",0)}function hi(i,t){if(i&1){let e=D();s(0,"a",6),w("click",function(){let o=_(e).$implicit,m=d(2);return b(m.activeTap.set(o.value))}),l(1),a()}if(i&2){let e=t.$implicit,n=d(2);F(Qe(3,bi,n.activeTap()===e.value,n.activeTap()===e.value,n.activeTap()===e.value)),r(),S(e.label)}}function yi(i,t){if(i&1&&(s(0,"div",1),T(1,hi,2,7,"a",5,N),a()),i&2){let e=d();r(),L(e.courseTabs)}}function wi(i,t){if(i&1&&c(0,"app-course-overview",2),i&2){let e=d();C("courseLoading",e.courseLoading())("description",e.courseDescription())("courseDataVMS",e.courseDataVMs())}}function Si(i,t){if(i&1){let e=D();s(0,"app-course-content",7),w("setActiveLesson",function(o){_(e);let m=d();return b(m.setActiveLesson.emit(o))}),a()}if(i&2){let e=d();C("topics",e.courseTopics())("isPaid",e.isPaid())("instructorId",e.courseInstructorId())}}function Ti(i,t){if(i&1&&c(0,"app-course-reviews",4),i&2){let e=d();C("customCourseReviews",e.courseCustomReviews())("isPaid",e.isPaid())("courseId",e.courseId())}}var Se=class i{courseTabs=[{label:"\u062A\u0641\u0627\u0635\u064A\u0644 \u0627\u0644\u0643\u0648\u0631\u0633",value:"overview"},{label:"\u0645\u062D\u062A\u0648\u0649 \u0627\u0644\u0643\u0648\u0631\u0633",value:"content"},{label:"\u0627\u0644\u062A\u0642\u064A\u064A\u0645\u0627\u062A",value:"reviews"}];activeTap=tt.required();courseLoading=u.required();courseDescription=u.required();courseDataVMs=u.required();courseTopics=u.required();isPaid=u.required();courseInstructorId=u.required();courseId=u.required();courseCustomReviews=u();setActiveLesson=V();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-tabs"]],inputs:{activeTap:[1,"activeTap"],courseLoading:[1,"courseLoading"],courseDescription:[1,"courseDescription"],courseDataVMs:[1,"courseDataVMs"],courseTopics:[1,"courseTopics"],isPaid:[1,"isPaid"],courseInstructorId:[1,"courseInstructorId"],courseId:[1,"courseId"],courseCustomReviews:[1,"courseCustomReviews"]},outputs:{activeTap:"activeTapChange",setActiveLesson:"setActiveLesson"},decls:7,vars:2,consts:[[1,"skeleton","w-full","h-12.5","lg:h-17.5","mb-6","lg:mb-8"],["role","tablist",1,"tabs","tabs-sm","lg:tabs-md","mb-6","lg:mb-8","rounded-sm","border","border-dashed","items-center","border-base-content","h-12.5","lg:h-17.5","px-3","lg:gap-27"],[3,"courseLoading","description","courseDataVMS"],[3,"topics","isPaid","instructorId"],[3,"customCourseReviews","isPaid","courseId"],["role","tab",1,"tab","lg:text-xl/7.5","text-base-content",3,"class"],["role","tab",1,"tab","lg:text-xl/7.5","text-base-content",3,"click"],[3,"setActiveLesson","topics","isPaid","instructorId"]],template:function(e,n){if(e&1&&(s(0,"section"),p(1,xi,1,0,"div",0)(2,yi,3,0,"div",1),We(3),p(4,wi,1,3,"app-course-overview",2)(5,Si,1,3,"app-course-content",3)(6,Ti,1,3,"app-course-reviews",4),ze(),a()),e&2){let o;r(),v(n.courseLoading()?1:2),r(3),v((o=n.activeTap())==="overview"?4:o==="content"?5:o==="reviews"?6:-1)}},dependencies:[he,ye,we],encapsulation:2,changeDetection:0})};var Te=class i{transform(t){if(!t)return null;let e;for(let n=0;n<t.length;n++){for(let o=0;o<t[n].lessonList.length;o++)if(t[n].lessonList[o].isActive){e=y(h({},t[n].lessonList[o]),{lIndex:o,tIndex:n});break}if(e)break}return e}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=re({name:"activeLesson",type:i,pure:!0})};function Li(i,t){i&1&&(s(0,"div",9),c(1,"div",10)(2,"div",11)(3,"div",11)(4,"div",11)(5,"div",12),a(),s(6,"div",9),c(7,"div",10),s(8,"div",13),c(9,"div",14)(10,"div",15)(11,"div",15)(12,"div",14),a()())}function Di(i,t){if(i&1&&(s(0,"div",20),l(1),a()),i&2){let e=t.$implicit;r(),I(" ",e.name," ")}}function Pi(i,t){if(i&1&&(s(0,"div",16)(1,"h4",17),l(2),a(),s(3,"p",18),l(4),a()(),s(5,"div",19)(6,"h4",17),l(7,"KeyWords"),a(),s(8,"div",13),T(9,Di,2,1,"div",20,N),a()()),i&2){d(2);let e=G(0);r(2),I(" ",e.firstName+" "+e.familyName," "),r(2),I(" ",e.instructorBrief," "),r(5),L(e.openKeys)}}function Ei(i,t){if(i&1&&p(0,Li,13,0)(1,Pi,11,2),i&2){d();let e=G(1);v(e?0:1)}}function Ii(i,t){if(i&1&&(s(0,"dialog",8)(1,"div",21),c(2,"app-payment-methods",22),s(3,"div",23)(4,"form",24)(5,"button",25),l(6,"\u0627\u0644\u063A\u0627\u0621"),a()()()()()),i&2){let e=d(),n=G(0);r(2),C("courses",e.courseArr())("totalValue",n.discountPrice)("totalOriginalValue",n.originalPrice||n.discountPrice)}}var Et=class i{courseService=f(Z);userService=f(z);cartService=f(fe);orderService=f(Ee);loaderService=f(ht);toastService=f(Q);favCourseService=f(wt);currencyService=f(de);router=f(ce);route=f(rt);courseLoading=U(!0);courseSignal=U({});courseArr=et(()=>[this.courseSignal()]);relatedCourses=U(Array(4));activeTap=U("overview");isMobile=matchMedia("(width <= 640px)").matches;constructor(){ue(()=>{if(this.courseSignal().isPaied){let t=JSON.parse(localStorage.getItem("watched-courses")??"{}");t[this.courseSignal().id]=this.courseSignal(),localStorage.setItem("watched-courses",JSON.stringify(t))}}),bt(this.userService.user).pipe(Ne(),_t()).subscribe(([t,e])=>{e||this.courseSignal.update(n=>y(h({},n),{isPaied:!1}))})}ngOnInit(){let t=!0;this.route.params.pipe(Ve({next:()=>{t||(this.relatedCourses.set(Array(4)),this.courseLoading.set(!0),this.activeTap.set("overview")),t=!1}}),ie(({courseId:e})=>Me([this.courseService.getCourseDetails(e,this.userService.user()?.id),this.courseService.getCustomCourseData(),this.courseService.getCustomCourseLabels(),this.courseService.getCustomCoursePrices(),this.courseService.getCourseFreeLessons()])),Fe(3)).subscribe({next:([e,n,o,m,x])=>{e.isPaied=!e.topics.some(g=>g.lessonList.some(q=>q.videoUrl==null&&q.fileUrl==null&&q.fileExternalUrl==null)),e.courseDataVMs=e.courseDataVMs.filter(g=>g.question&&g.answers.length&&g.answers[0]?.answer);let k;if(e.isPaied){let g=JSON.parse(localStorage.getItem("watched-courses")??"{}");g[e.id]?e.topics=g[e.id].topics:e.topics.unshift({id:0,topicName_AR:"\u0627\u0644\u0645\u0642\u062F\u0645\u0629",isActive:!0,lessonList:[{name_AR:"\u0628\u0631\u0648\u0645\u0648 \u0627\u0644\u0643\u0648\u0631\u0633",videoUrl:e.videoPromoURL,id:0,isActive:!0,public:!0,courseId:e.id}]})}else{let g=m.find(M=>M["course-id"]==e.id);g&&["EG","SA"].includes(te())&&(e.discountPrice=Math.ceil((te()==="EG"?g["egp-price"]:g["sar-price"])/this.currencyService.currency().value)),k=n.find(M=>M.id==e.id)??x.find(M=>M.id==e.id);let q=(o.find(M=>M.course_ids?.includes(e.id))??o.find(M=>M.allCourses))?.label;if(q&&(e.paymentLabel=q),k){let M=[],X=!(e.isPaied||this.userService.user()?.roleType==1||e.userId==this.userService.user()?.id);k.sections_with_free_lessons.forEach(A=>{A.free_lessons_indexes.forEach(Ie=>{e.topics[A.index-1].lessonList[Ie-1].public=!0,X&&M.push(e.topics[A.index-1].lessonList[Ie-1])})}),X&&e.topics.unshift({id:0,topicName_AR:"\u0627\u0644\u062F\u0631\u0648\u0633 \u0627\u0644\u0645\u062C\u0627\u0646\u064A\u0629",lessonList:M})}e.topics.unshift({id:0,topicName_AR:"\u0627\u0644\u0645\u0642\u062F\u0645\u0629",isActive:!0,lessonList:[{name_AR:"\u0628\u0631\u0648\u0645\u0648 \u0627\u0644\u0643\u0648\u0631\u0633",videoUrl:e.videoPromoURL,id:0,isActive:!0,public:!0,courseId:e.id}]})}e.attachments=e.topics.reduce((g,q)=>{let X=(q.fileList??[]).concat(q.lessonList.filter(A=>A.fileExternalUrl||A.fileUrl).map(A=>({attachmentFileName:A.fileName,id:Math.random(),lessonName:A.name_AR,attachmentLink:A.fileUrl,attachmentName:A.fileUrlName,attachmentsExternalLink:A.fileExternalUrl})));return X.length&&g.push({title:q.topicName_AR,data:X}),g},[]),this.courseSignal.set(h(h({},e),k&&k)),this.courseLoading.set(!1),this.courseService.getCoursesByDepartmentWithFilter("",e.departmentsId,1,1).subscribe({next:({list:g})=>{this.relatedCourses.set(g.slice(0,4))},error:g=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:g.message})}})},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}})}loadNextVideoHandler(t){if(this.courseSignal().isPaied){let e=null;t.tIndex==this.courseSignal().topics.length-1?t.lIndex!=this.courseSignal().topics[t.tIndex].lessonList.length-1&&(e=this.courseSignal().topics[t.tIndex].lessonList[t.lIndex+1]):t.lIndex!=this.courseSignal().topics[t.tIndex].lessonList.length-1?e=this.courseSignal().topics[t.tIndex].lessonList[t.lIndex+1]:e=this.courseSignal().topics[t.tIndex+1].lessonList[0],this.courseSignal.update(n=>y(h({},n),{topics:n.topics.map(o=>{let m=!1,x=0,k=o.lessonList.map(g=>(e?.id===g.id&&(m=!0),(g.isWatched||g.id===t.id)&&x++,g.id===t.id?y(h({},g),{isWatched:!0,autoplay:!1,isActive:!1}):e&&e.id===g.id?y(h({},g),{autoplay:!0,isActive:!0}):g));return y(h({},o),{lessonList:k,isActive:m,isWatched:x===o.lessonList.length})})}))}}setActiveLessonHandle(t){this.courseSignal.update(e=>y(h({},e),{topics:e.topics.map(n=>{let o,m=0,x=n.lessonList.map(k=>(k.id===t&&(o=!0),k.isWatched&&m++,k.id!==t?y(h({},k),{autoplay:!1,isActive:!1}):y(h({},k),{autoplay:!0,isActive:!0})));return y(h({},n),{lessonList:x,isActive:o,isWatched:m===n.lessonList.length})})}))}addToCartHandler(){this.cartService.addToCart(this.courseSignal())}applyCouponHandler(t){if(t){if(t.coboneType==0||t.success){this.loaderService.toggleLoader(!0),this.orderService.createOrder(this.userService.user(),0,this.courseSignal().originalPrice,[y(h({},this.courseSignal()),{coupon:t,discountPrice:0})],t.id).pipe(J(()=>this.loaderService.toggleLoader(!1))).subscribe({next:()=>{this.courseSignal.update(e=>y(h({},e),{isPaied:!0})),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0648\u0634\u0631\u0627\u0621 \u0627\u0644\u0643\u0648\u0631\u0633 \u0628\u0646\u062C\u0627\u062D",iconClass:"solar--bill-check-outline"})},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}});return}else if(t.coboneType==2)this.courseSignal.update(e=>y(h({},e),{coupon:t}));else{let e=0,n=this.courseSignal().discountPrice||this.courseSignal().originalPrice;switch(t.coboneType){case 1:e=n-t.value;break;case 3:e=Math.ceil(n-n/100*t.value);break}if(!this.cartService.cart().coupon){let o=[...this.cartService.cart().items],m=o.findIndex(x=>x.id==this.courseSignal().id);m!=-1&&(o[m].priceBeforeCoupon=o[m].discountPrice,o[m].discountPrice=e,o[m].coupon=t,this.cartService.setCart({coupon:t,items:o}))}this.courseSignal.update(o=>y(h({},o),{coupon:t,priceBeforeCoupon:o.discountPrice,discountPrice:e}))}this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0628\u0646\u062C\u0627\u062D",iconClass:"solar--bill-check-outline"})}else{if(this.cartService.cart().coupon?.id===this.courseSignal().coupon?.id){let e=[...this.cartService.cart().items],n=e.findIndex(o=>o.id==this.courseSignal().id);n!=-1&&(e[n].discountPrice=e[n].priceBeforeCoupon,e[n].priceBeforeCoupon=0,e[n].coupon=void 0,this.cartService.setCart({coupon:null,items:e}))}this.courseSignal.update(e=>y(h({},e),{coupon:void 0,discountPrice:e.priceBeforeCoupon,priceBeforeCoupon:0})),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u0627\u0644\u063A\u0627\u0621 \u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0628\u0646\u062C\u0627\u062D"})}}changeCoursePriceHandler(t){this.courseSignal.update(e=>y(h({},e),{discountPrice:t,priceBeforeCoupon:e.discountPrice}))}addToFavCoursesHandler(){this.favCourseService.addToFavCourses(this.courseSignal())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-course-details"]],features:[ae([Z,Ee,xt])],decls:13,vars:40,consts:[[1,"container"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-x-0","gap-y-6","lg:gap-y-0","lg:gap-x-8","border-b-base-content","py-6","lg:py-10"],[1,"col-span-3","order-2","lg:order-1"],[3,"nextVideo","toggleFavCourse","courseLoading","title","isFavourite","activeLesson"],[3,"activeTapChange","setActiveLesson","activeTap","courseInstructorId","courseLoading","courseCustomReviews","courseTopics","courseDescription","courseDataVMs","isPaid","courseId"],[1,"order-1","lg:order-2"],[3,"addToCart","applyCoupon","changePrice","keywords","courseLoading","studentsCount","lessonCount","instructorBrief","instructorName","hourCount","discountPrice","originalPrice","isPaid","instructorId","courseId","coupon","courseName","courseImg","courseRedirectUrl","coursePaymentLabel"],[3,"courseLoading","courses"],["id","courssat_checkout_modal",1,"modal"],[1,"mb-4"],[1,"skeleton","w-1/2","h-6","lg:h-7","mb-4"],[1,"skeleton","w-full","h-5","lg:h-6","mb-2"],[1,"skeleton","w-full","h-5","lg:h-6"],[1,"flex","flex-wrap","gap-3"],[1,"skeleton","w-1/3","h-8","lg:h-10"],[1,"skeleton","w-1/2","h-8","lg:h-10"],[1,"p-4","border","border-dashed","rounded-sm","mb-6"],[1,"lg:text-xl","text-body-5","font-bold","mb-4"],[1,"text-sm","lg:text-base","text-base-content"],[1,"p-4","border","border-dashed","rounded-sm"],[1,"p-2","text-sm","lg:text-base","rounded-sm","text-secondary","bg-secondary-5"],[1,"modal-box","max-w-3xl","max-h-9/10"],["customPaymentBtnClass","w-full",3,"courses","totalValue","totalOriginalValue"],[1,"modal-action","justify-stretch","sticky","bottom-0"],["method","dialog",1,"flex-1"],[1,"btn","btn-lg","btn-ghost","w-full"]],template:function(e,n){if(e&1){let o=D();se(0)(1),s(2,"div",0)(3,"div",1)(4,"div",2)(5,"app-course-video",3),O(6,"activeLesson"),w("nextVideo",function(x){return _(o),b(n.loadNextVideoHandler(x))})("toggleFavCourse",function(){return _(o),b(n.addToFavCoursesHandler())}),a(),s(7,"app-course-tabs",4),Ye("activeTapChange",function(x){return _(o),Je(n.activeTap,x)||(n.activeTap=x),b(x)}),w("setActiveLesson",function(x){return _(o),b(n.setActiveLessonHandle(x))}),a()(),s(8,"div",5)(9,"app-course-sidebar",6),w("addToCart",function(){return _(o),b(n.addToCartHandler())})("applyCoupon",function(x){return _(o),b(n.applyCouponHandler(x))})("changePrice",function(x){return _(o),b(n.changeCoursePriceHandler(x))}),a()()(),p(10,Ei,2,1),c(11,"app-course-related-courses",7),a(),p(12,Ii,7,3,"dialog",8)}if(e&2){let o=ee(n.courseSignal());r();let m=ee(n.courseLoading());r(2),j("border-b",!m&&!n.isMobile),r(2),C("courseLoading",m)("title",o.courseName_AR)("isFavourite",n.favCourseService.isFavCourse(o.id))("activeLesson",Xe(6,38,o.topics)),r(2),Ke("activeTap",n.activeTap),C("courseInstructorId",o.userId)("courseLoading",m)("courseCustomReviews",o.reviews)("courseTopics",o.topics)("courseDescription",o.courseDescription_AR)("courseDataVMs",o.courseDataVMs)("isPaid",o.isPaied)("courseId",o.id),r(2),C("keywords",o.openKeys)("courseLoading",m)("studentsCount",o.studentsCount)("lessonCount",o.lessonCount)("instructorBrief",o.instructorBrief)("instructorName",o.firstName+" "+o.familyName)("hourCount",o.hourCount)("discountPrice",o.discountPrice)("originalPrice",o.originalPrice)("isPaid",!!o.isPaied)("instructorId",o.userId)("courseId",o.id)("coupon",o.coupon)("courseName",o.courseName_AR)("courseImg",o.coverImageURL)("courseRedirectUrl",o.redirect_url)("coursePaymentLabel",o.paymentLabel),r(),v(n.isMobile?10:-1),r(),C("courseLoading",m)("courses",n.relatedCourses()),r(),v(o.id&&!o.isPaied?12:-1)}},dependencies:[ge,Ce,xe,Se,yt,Te],encapsulation:2})};export{Et as CourseDetails};
