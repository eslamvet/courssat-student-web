import{a as D}from"./chunk-SEHUKUSY.js";import{a as ie,c as ne,f as re,i as ae,o as oe}from"./chunk-W4TJDPBM.js";import{a as B,b as de}from"./chunk-3XSZFALT.js";import{a as se}from"./chunk-YJRBJEMI.js";import{a as ce}from"./chunk-KI76VGTE.js";import{a as le}from"./chunk-BNCCPNSP.js";import"./chunk-P6OX5KW3.js";import{e as Z,g as ee,k as te}from"./chunk-NLB5HRRX.js";import{a as ue}from"./chunk-5I5XZVIT.js";import{g as W,h as X}from"./chunk-5NPNKZ3O.js";import{h as K,q as Q}from"./chunk-VE6ZJ4JM.js";import{E as $,Fb as M,Jb as w,Lb as v,Sa as a,Vb as q,Wb as S,Xb as u,Yb as b,Zb as m,a as d,aa as f,b as p,bc as V,c as L,cc as E,dc as k,fa as _,fb as j,fc as J,ga as P,ha as O,ia as R,ib as z,ic as h,kc as x,mc as g,o as N,pa as U,qb as F,rb as A,s as H,tb as G,ub as Y,vb as y,wb as i,xb as l,yb as s}from"./chunk-VRT4WXDD.js";var T=class c{transform(o,e){return o.reduce((t,n)=>t+n[e],0)}static \u0275fac=function(e){return new(e||c)};static \u0275pipe=z({name:"sum",type:c,pure:!0})};var C=(c,o)=>({"font-saudi-riyal":c,"text-lg":o}),xe=(c,o)=>o.id;function ge(c,o){if(c&1){let e=M();i(0,"div",24)(1,"div",25),s(2,"img",26),x(3,"imgUrl"),l(),i(4,"div",27)(5,"h4",28),u(6),l(),i(7,"div",29)(8,"div",30),s(9,"span",31),i(10,"span",32),u(11),l()(),i(12,"div",30),s(13,"span",33),i(14,"span",32),u(15),x(16,"number"),i(17,"span"),u(18),l()()()()(),i(19,"div",34)(20,"div",30),s(21,"span",31),i(22,"span",32),u(23),l()(),i(24,"div",30),s(25,"span",33),i(26,"span",32),u(27),x(28,"number"),i(29,"span"),u(30),l()()()(),i(31,"button",35),w("click",function(){let n=_(e).$index,r=v(2);return P(r.removeCartItemHandler(n))}),s(32,"span",36),l()()}if(c&2){let e=o.$implicit,t=o.$index,n=o.$count,r=v(2);q("mb-4",t!==n-1),a(2),y("ngSrc",g(3,15,e.coverImageURL,e.packageName?"package":"course"))("fill",!0),a(4),m(" ",e.courseName_AR??e.packageName," "),a(5),b(e.firstName+" "+(e.familyName??"")),a(4),b(g(16,18,(e.discountPrice||e.originalPrice||0)*r.currency.value,"1.0-0")),a(2),S(h(24,C,r.isSaudi,r.isSaudi)),a(),b(r.currency.code),a(5),b(e.firstName+" "+(e.familyName??"")),a(4),b(g(28,21,(e.discountPrice||e.originalPrice||0)*r.currency.value,"1.0-0")),a(2),S(h(27,C,r.isSaudi,r.isSaudi)),a(),b(r.currency.code)}}function fe(c,o){c&1&&s(0,"span",17)}function be(c,o){if(c&1){let e=M();i(0,"div",1)(1,"div",3)(2,"div",4)(3,"h3",5),u(4),l(),i(5,"button",6),w("click",function(){_(e);let n=v();return P(n.resetCartHandler())}),s(6,"span",7),u(7," \u062D\u0630\u0641 \u0643\u0644 \u0627\u0644\u0639\u0646\u0627\u0635\u0631 "),l()(),G(8,ge,33,30,"div",8,xe),l(),i(10,"div",9),s(11,"app-payment-methods",10),l(),i(12,"div",3)(13,"div",11)(14,"label",12),s(15,"span",13)(16,"input",14),l(),s(17,"div",15),i(18,"button",16),w("click",function(){_(e);let n=v();return P(n.applyCouponHandler())}),i(19,"span"),u(20),l(),F(21,fe,1,0,"span",17),l()(),i(22,"h3",18),u(23,"\u0627\u0644\u0645\u062C\u0645\u0648\u0639"),l(),i(24,"ul",19)(25,"li",20)(26,"h5",21),u(27,"\u0627\u0644\u0645\u062C\u0645\u0648\u0639"),l(),s(28,"div",22),i(29,"h5",21),u(30),x(31,"number"),i(32,"span"),u(33),l()()(),i(34,"li",20)(35,"h5",21),u(36,"\u0627\u0644\u062E\u0635\u0645"),l(),s(37,"div",22),i(38,"h5",21),u(39),x(40,"number"),i(41,"span"),u(42),l()()(),i(43,"li",23)(44,"h5",21),u(45,"\u0627\u0644\u0645\u062C\u0645\u0648\u0639 \u0627\u0644\u0643\u0644\u064A"),l(),s(46,"div",22),i(47,"h5",21),u(48),x(49,"number"),i(50,"span"),u(51),l()()()()()()}if(c&2){let e=v(),t=k(0),n=k(1),r=k(3);a(4),m(" \u0627\u0644\u0643\u0648\u0631\u0633\u0627\u062A (",t.items.length," \u0639\u0646\u0627\u0635\u0631) "),a(4),Y(t.items),a(3),y("courses",t.items)("totalValue",r)("totalOriginalValue",n),a(5),y("formControl",e.couponCode)("readOnly",!!t.coupon),a(2),y("disabled",!e.couponCode.value||e.couponLoading()),a(2),b(t.coupon?"\u0627\u0644\u063A\u0627\u0621":"\u062A\u0641\u0639\u064A\u0644"),a(),A(e.couponLoading()?21:-1),a(9),m(" ",g(31,21,n*e.currency.value,"1.0-0")," "),a(2),S(h(30,C,e.isSaudi,e.isSaudi)),a(),m("",e.currency.code," "),a(6),m(" ",g(40,24,(n-r)*e.currency.value,"1.0-0")," "),a(2),S(h(33,C,e.isSaudi,e.isSaudi)),a(),m("",e.currency.code," "),a(6),m(" ",g(49,27,r*e.currency.value,"1.0-0")," "),a(2),S(h(36,C,e.isSaudi,e.isSaudi)),a(),m("",e.currency.code," ")}}function ve(c,o){c&1&&(i(0,"div",2)(1,"div",37)(2,"div",38),O(),i(3,"svg",39),s(4,"path",40),l()(),R(),i(5,"h2",41),u(6,"\u0639\u0631\u0628\u0629 \u0627\u0644\u062A\u0633\u0648\u0642 \u0641\u0627\u0631\u063A\u0629"),l(),i(7,"p",42),u(8,"\u064A\u0628\u062F\u0648 \u0623\u0646\u0643 \u0644\u0645 \u062A\u064F\u0636\u0641 \u0623\u064A \u0634\u064A\u0621 \u0625\u0644\u0649 \u0633\u0644\u0629 \u0627\u0644\u062A\u0633\u0648\u0642 \u0627\u0644\u062E\u0627\u0635\u0629 \u0628\u0643 \u062D\u062A\u0649 \u0627\u0644\u0622\u0646."),l(),i(9,"button",43),u(10,"\u0627\u0628\u062F\u0623 \u0627\u0644\u062A\u0633\u0648\u0642"),l()()())}var pe=class c{cartService=f(ce);orderService=f(B);userService=f(te);toastService=f(ue);router=f(W);currency=f(Z).currency();isSaudi=ee()=="SA";cartSignal=this.cartService.cart;couponLoading=U(!1);couponCode=new re("",{nonNullable:!0});couponService=f(D);removeCartItemHandler(o){this.cartService.updateCart(e=>p(d({},e),{items:e.items.filter((t,n)=>o!==n)}))}applyCouponHandler(){return L(this,null,function*(){if(!this.couponLoading()){if(this.couponLoading.set(!0),this.cartSignal().coupon){this.cartService.updateCart(o=>p(d({},o),{coupon:null,items:o.items.map(e=>p(d({},e),{coupon:void 0,discountPrice:e.originalPrice,originalPrice:e.priceBeforeCoupon}))}));return}this.couponService.applyCoupon(this.couponCode.value,0).pipe($(()=>N(null))).subscribe({next:o=>L(this,null,function*(){if(o)o.coboneType!==2?this.cartService.updateCart(e=>p(d({},e),{coupon:o,items:e.items.map(t=>([1,3].includes(o.coboneType)&&(t.coupon=o,t.priceBeforeCoupon=t.originalPrice,t.originalPrice=t.discountPrice,t.discountPrice=o.coboneType==1?t.discountPrice-o.value:+(t.discountPrice-t.discountPrice/100*o.value).toFixed(2)),t))})):this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0647\u0630\u0627 \u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0645\u062A\u0627\u062D \u0641\u064A \u0635\u0641\u062D\u0647 \u0627\u0644\u0643\u0648\u0631\u0633 \u0641\u0642\u0637"}),this.couponLoading.set(!1);else for(let e=0;e<=this.cartSignal().items.length;e++)try{let t=yield H(this.couponService.applyCoupon(this.couponCode.value,this.cartSignal().items[e].id));switch(this.couponLoading.set(!1),t.coboneType){case 0:this.orderService.createOrder(this.userService.user(),0,this.cartSignal().items.reduce((n,r)=>n+=r.originalPrice||r.discountPrice,0),this.cartSignal().items.map(n=>p(d({},n),{coupon:t})),t.id).subscribe({next:()=>{this.cartService.setCart({items:[],coupon:null}),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u0627\u0644\u0634\u0631\u0627\u0621 \u0628\u0646\u062C\u0627\u062D"}),this.router.navigate(["profile","my-courses"])},error:n=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:n.message})}});break;case 1:this.cartService.updateCart(n=>p(d({},n),{coupon:t,items:n.items.map((r,I)=>e===I?p(d({},r),{coupon:t,priceBeforeCoupon:r.originalPrice,originalPrice:r.discountPrice,discountPrice:r.discountPrice-t.value}):r)}));break;case 2:this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0647\u0630\u0627 \u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u0645\u062A\u0627\u062D \u0641\u064A \u0635\u0641\u062D\u0647 \u0627\u0644\u0643\u0648\u0631\u0633 \u0641\u0642\u0637"});break;case 3:this.cartService.updateCart(n=>p(d({},n),{coupon:t,items:n.items.map((r,I)=>e===I?p(d({},r),{coupon:t,priceBeforeCoupon:r.originalPrice,originalPrice:r.discountPrice,discountPrice:+(r.discountPrice-r.discountPrice/100*t.value).toFixed(2)}):r)}));break}break}catch{e===this.cartSignal().items.length&&(this.couponLoading.set(!1),this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:"\u0627\u0644\u0643\u0648\u0628\u0648\u0646 \u063A\u064A\u0631 \u0635\u0627\u0644\u062D"}))}})})}})}resetCartHandler(){this.cartService.setCart({coupon:null,items:[]})}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=j({type:c,selectors:[["app-cart"]],features:[J([D,B,se])],decls:8,vars:10,consts:[[1,"container","py-8","lg:py-14"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-y-4","lg:gap-y-8","lg:gap-x-8"],[1,"card","w-full","max-w-md","bg-base-100","mx-auto"],[1,"col-span-2","bg-base-200","rounded-sm","px-4","pt-4","pb-6","lg:p-8"],[1,"flex","items-center","justify-between","gap-4","lg:gap-6","mb-8"],[1,"text-lg","lg:text-3xl","font-bold","text-body-5"],[1,"btn","btn-sm","lg:btn-base","btn-ghost","px-0","border-0","hover:bg-transparent","shadow-none",3,"click"],[1,"iconify","ic--outline-delete","text-2xl","text-danger"],[1,"flex","flex-wrap","items-center","lg:items-start","bg-white","gap-3","lg:gap-4","border","border-dashed","border-base-content","rounded-sm","p-3","lg:p-4",3,"mb-4"],[1,"bg-base-200","rounded-sm","px-4","pt-4","pb-6","lg:p-8"],[3,"courses","totalValue","totalOriginalValue"],[1,"py-1","px-4","flex","gap-7","bg-neutral","mb-6"],[1,"input","bg-transparent","border-none","shadow-none","outline-none","flex-1"],[1,"iconify","hugeicons--coupon-01","text-2xl","text-base-content"],["type","text","placeholder","\u0623\u062F\u062E\u0644 \u0631\u0645\u0632 \u0627\u0644\u0643\u0648\u0628\u0648\u0646",1,"text-base-content","placeholder:text-base-content","placeholder:opacity-50",3,"formControl","readOnly"],[1,"border-r","border-dashed","border-base-content"],[1,"btn","btn-link","text-secondary","px-0","no-underline",3,"click","disabled"],[1,"loading","loading-ring","text-secondary"],[1,"text-lg","lg:text-3xl","font-bold","text-body-5","mb-4","lg:mb-8"],[1,"list-none"],[1,"flex","items-center","gap-3","lg:gap-4","mb-3","lg:mb-4"],[1,"text-sm","lg:text-xl","text-base-content","font-normal"],[1,"border-t","border-dashed","border-base-content","flex-1"],[1,"flex","items-center","gap-3","lg:gap-4"],[1,"flex","flex-wrap","items-center","lg:items-start","bg-white","gap-3","lg:gap-4","border","border-dashed","border-base-content","rounded-sm","p-3","lg:p-4"],[1,"relative","w-27","h-16","lg:w-49","lg:h-29"],["priority","",1,"rounded-tr-sm","rounded-br-sm",3,"ngSrc","fill"],[1,"flex-1"],[1,"text-xs","flex-1","order-2","lg:text-2xl","font-bold","text-body-5","lg:mb-4"],[1,"hidden","lg:flex","gap-3","lg:gap-8"],[1,"flex","items-center","gap-2"],[1,"iconify","solar--user-circle-broken","text-lg","lg:text-2xl","text-base-700"],[1,"text-xs","lg:text-sm","text-base-700"],[1,"iconify","solar--tag-price-broken","text-lg","lg:text-2xl","text-base-content"],[1,"flex-1","flex","lg:hidden","gap-3","lg:gap-8"],[1,"btn","btn-sm","lg:btn-md","btn-circle","bg-base-600",3,"click"],[1,"iconify","ic--outline-delete","text-xl","lg:text-2xl","text-danger"],[1,"card-body","items-center","text-center","gap-4"],[1,"w-24","h-24","rounded-full","bg-primary/10","flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-12","w-12","text-primary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","1.5","d","M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2 6m12-6l2 6M9 21h6"],[1,"card-title","text-xl","font-semibold"],[1,"text-base-content/70"],["routerLink","/",1,"btn","mt-4","btn-primary","w-full"]],template:function(e,t){if(e&1&&(V(0)(1),x(2,"sum"),V(3),x(4,"sum"),i(5,"section",0),F(6,be,52,39,"div",1)(7,ve,11,0,"div",2),l()),e&2){let n=E(t.cartSignal());a(),E(g(2,2,n.items,"originalPrice")),a(2),E(g(4,6,n.items,"discountPrice")),a(3),A(n.items.length?6:7)}},dependencies:[Q,de,X,oe,ie,ne,ae,le,K,T],encapsulation:2})};export{pe as Cart};
