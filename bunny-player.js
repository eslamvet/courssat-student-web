(function(u,f){function v(e){return function(){var t={method:e},r=Array.prototype.slice.call(arguments);/^get/.test(e)?(n.assert(r.length>0,"Get methods require a callback."),r.unshift(t)):(/^set/.test(e)&&(n.assert(r.length!==0,"Set methods require a value."),t.value=r[0]),r=[t]),this.send.apply(this,r)}}var n={};n.DEBUG=!1,n.VERSION="0.0.11",n.CONTEXT="player.js",n.POST_MESSAGE=!!u.postMessage,n.origin=function(e){return e.substr(0,2)==="//"&&(e=u.location.protocol+e),e.split("/").slice(0,3).join("/")},n.addEvent=function(e,t,r){e&&(e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r)},n.log=function(){n.log.history=n.log.history||[],n.log.history.push(arguments),u.console&&n.DEBUG&&u.console.log(Array.prototype.slice.call(arguments))},n.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},n.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"},n.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},n.isNone=function(e){return e==null},n.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.indexOf=function(e,t){if(e==null)return-1;var r=0,i=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;i>r;r++)if(e[r]===t)return r;return-1},n.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},n.Keeper=function(){this.init()},n.Keeper.prototype.init=function(){this.data={}},n.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,r=e==="x"?t:3&t|8;return r.toString(16)})},n.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(n.isNone(t))return!0;for(var r=this.data[e],i=0;i<r.length;i++)if(r[i].id===t)return!0;return!1},n.Keeper.prototype.add=function(e,t,r,i,o){var s={id:e,event:t,cb:r,ctx:i,one:o};this.has(t)?this.data[t].push(s):this.data[t]=[s]},n.Keeper.prototype.execute=function(e,t,r,i){if(!this.has(e,t))return!1;for(var o=[],s=[],a=0;a<this.data[e].length;a++){var d=this.data[e][a];n.isNone(t)||!n.isNone(t)&&d.id===t?(s.push({cb:d.cb,ctx:d.ctx?d.ctx:i,data:r}),d.one===!1&&o.push(d)):o.push(d)}o.length===0?delete this.data[e]:this.data[e]=o;for(var l=0;l<s.length;l++){var h=s[l];h.cb.call(h.ctx,h.data)}},n.Keeper.prototype.on=function(e,t,r,i){this.add(e,t,r,i,!1)},n.Keeper.prototype.one=function(e,t,r,i){this.add(e,t,r,i,!0)},n.Keeper.prototype.off=function(e,t){var r=[];if(!this.data.hasOwnProperty(e))return r;for(var i=[],o=0;o<this.data[e].length;o++){var s=this.data[e][o];n.isNone(t)||s.cb===t?n.isNone(s.id)||r.push(s.id):i.push(s)}return i.length===0?delete this.data[e]:this.data[e]=i,r},n.Player=function(e,t){return this instanceof n.Player?void this.init(e,t):new n.Player(e,t)},n.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},n.EVENTS.all=function(){var e=[];for(var t in n.EVENTS)n.has(n.EVENTS,t)&&n.isString(n.EVENTS[t])&&e.push(n.EVENTS[t]);return e},n.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},n.METHODS.all=function(){var e=[];for(var t in n.METHODS)n.has(n.METHODS,t)&&n.isString(n.METHODS[t])&&e.push(n.METHODS[t]);return e},n.READIED=[],n.Player.prototype.init=function(e,t){var r=this;n.isString(e)&&(e=f.getElementById(e)),this.elem=e,n.assert(e.nodeName==="IFRAME",'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),n.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=n.origin(e.src),this.keeper=new n.Keeper,this.isReady=!1,this.queue=[],this.events=n.EVENTS.all(),this.methods=n.METHODS.all(),n.POST_MESSAGE?n.addEvent(u,"message",function(i){r.receive(i)}):n.log("Post Message is not Available."),n.indexOf(n.READIED,e.src)>-1?r.loaded=!0:this.elem.onload=function(){r.loaded=!0}},n.Player.prototype.send=function(e,t,r){if(e.context=n.CONTEXT,e.version=n.VERSION,t){var i=this.keeper.getUUID();e.listener=i,this.keeper.one(i,e.method,t,r)}return this.isReady||e.value==="ready"?(n.log("Player.send",e,this.origin),this.loaded===!0&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(n.log("Player.queue",e),this.queue.push(e),!1)},n.Player.prototype.receive=function(e){if(n.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch{return!1}return t.context!==n.CONTEXT?!1:(t.event==="ready"&&t.value&&t.value.src===this.elem.src&&this.ready(t),void(this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)))},n.Player.prototype.ready=function(e){if(this.isReady===!0)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var r=this.queue[t];n.log("Player.dequeue",r),e.event==="ready"&&this.keeper.execute(r.event,r.listener,!0,this),this.send(r)}this.queue=[]},n.Player.prototype.on=function(e,t,r){var i=this.keeper.getUUID();return e==="ready"?this.keeper.one(i,e,t,r):this.keeper.on(i,e,t,r),this.send({method:"addEventListener",value:e,listener:i}),!0},n.Player.prototype.off=function(e,t){var r=this.keeper.off(e,t);if(n.log("Player.off",r),r.length>0)for(var i in r)return this.send({method:"removeEventListener",value:e,listener:r[i]}),!0;return!1},n.Player.prototype.supports=function(e,t){n.assert(n.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=n.isArray(t)?t:[t];for(var r=e==="event"?this.events:this.methods,i=0;i<t.length;i++)if(n.indexOf(r,t[i])===-1)return!1;return!0};for(var c=0,y=n.METHODS.all().length;y>c;c++){var p=n.METHODS.all()[c];n.Player.prototype.hasOwnProperty(p)||(n.Player.prototype[p]=v(p))}n.addEvent(u,"message",function(e){var t;try{t=JSON.parse(e.data)}catch{return!1}return t.context!==n.CONTEXT?!1:void(t.event==="ready"&&t.value&&t.value.src&&n.READIED.push(t.value.src))}),n.Receiver=function(e,t){this.init(e,t)},n.Receiver.prototype.init=function(e,t){var r=this;this.isReady=!1,this.origin=n.origin(f.referrer),this.methods={},this.supported={events:e||n.EVENTS.all(),methods:t||n.METHODS.all()},this.eventListeners={},this.reject=!(u.self!==u.top&&n.POST_MESSAGE),this.reject||n.addEvent(u,"message",function(i){r.receive(i)})},n.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t={};if(n.isObject(e.data))t=e.data;else try{t=u.JSON.parse(e.data)}catch(o){n.log("JSON Parse Error",o)}if(n.log("Receiver.receive",e,t),!t.method||t.context!==n.CONTEXT)return!1;if(n.indexOf(n.METHODS.all(),t.method)===-1)return this.emit("error",{code:2,msg:'Invalid Method "'+t.method+'"'}),!1;var r=n.isNone(t.listener)?null:t.listener;if(t.method==="addEventListener")this.eventListeners.hasOwnProperty(t.value)?n.indexOf(this.eventListeners[t.value],r)===-1&&this.eventListeners[t.value].push(r):this.eventListeners[t.value]=[r],t.value==="ready"&&this.isReady&&this.ready();else if(t.method==="removeEventListener"){if(this.eventListeners.hasOwnProperty(t.value)){var i=n.indexOf(this.eventListeners[t.value],r);i>-1&&this.eventListeners[t.value].splice(i,1),this.eventListeners[t.value].length===0&&delete this.eventListeners[t.value]}}else this.get(t.method,t.value,r)},n.Receiver.prototype.get=function(e,t,r){var i=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var o=this.methods[e];if(e.substr(0,3)==="get"){var s=function(a){i.send(e,a,r)};o.call(this,s)}else o.call(this,t)},n.Receiver.prototype.on=function(e,t){this.methods[e]=t},n.Receiver.prototype.send=function(e,t,r){if(n.log("Receiver.send",e,t,r),this.reject)return n.log("Receiver.send.reject",e,t,r),!1;var i={context:n.CONTEXT,version:n.VERSION,event:e};n.isNone(t)||(i.value=t),n.isNone(r)||(i.listener=r);var o=JSON.stringify(i);u.parent.postMessage(o,this.origin===""?"*":this.origin)},n.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;n.log("Instance.emit",e,t,this.eventListeners[e]);for(var r=0;r<this.eventListeners[e].length;r++){var i=this.eventListeners[e][r];this.send(e,t,i)}return!0},n.Receiver.prototype.ready=function(){n.log("Receiver.ready"),this.isReady=!0;var e={src:u.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},n.HTML5Adapter=function(e){return this instanceof n.HTML5Adapter?void this.init(e):new n.HTML5Adapter(e)},n.HTML5Adapter.prototype.init=function(e){n.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new n.Receiver;e.addEventListener("playing",function(){t.emit("play")}),e.addEventListener("pause",function(){t.emit("pause")}),e.addEventListener("ended",function(){t.emit("ended")}),e.addEventListener("timeupdate",function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})}),e.addEventListener("progress",function(){t.emit("buffered",{percent:e.buffered.length})}),t.on("play",function(){e.play()}),t.on("pause",function(){e.pause()}),t.on("getPaused",function(r){r(e.paused)}),t.on("getCurrentTime",function(r){r(e.currentTime)}),t.on("setCurrentTime",function(r){e.currentTime=r}),t.on("getDuration",function(r){r(e.duration)}),t.on("getVolume",function(r){r(100*e.volume)}),t.on("setVolume",function(r){e.volume=r/100}),t.on("mute",function(){e.muted=!0}),t.on("unmute",function(){e.muted=!1}),t.on("getMuted",function(r){r(e.muted)}),t.on("getLoop",function(r){r(e.loop)}),t.on("setLoop",function(r){e.loop=r})},n.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},n.JWPlayerAdapter=function(e){return this instanceof n.JWPlayerAdapter?void this.init(e):new n.JWPlayerAdapter(e)},n.JWPlayerAdapter.prototype.init=function(e){n.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new n.Receiver;this.looped=!1,e.on("pause",function(){t.emit("pause")}),e.on("play",function(){t.emit("play")}),e.on("time",function(i){var o=i.position,s=i.duration;if(!o||!s)return!1;var a={seconds:o,duration:s};t.emit("timeupdate",a)});var r=this;e.on("complete",function(){r.looped===!0?e.seek(0):t.emit("ended")}),e.on("error",function(){t.emit("error")}),t.on("play",function(){e.play(!0)}),t.on("pause",function(){e.pause(!0)}),t.on("getPaused",function(i){i(e.getState().toLowerCase()!=="PLAYING".toLowerCase())}),t.on("getCurrentTime",function(i){i(e.getPosition())}),t.on("setCurrentTime",function(i){e.seek(i)}),t.on("getDuration",function(i){i(e.getDuration())}),t.on("getVolume",function(i){i(e.getVolume())}),t.on("setVolume",function(i){e.setVolume(i)}),t.on("mute",function(){e.setMute(!0)}),t.on("unmute",function(){e.setMute(!1)}),t.on("getMuted",function(i){i(e.getMute()===!0)}),t.on("getLoop",function(i){i(this.looped)},this),t.on("setLoop",function(i){this.looped=i},this)},n.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},n.MockAdapter=function(){return this instanceof n.MockAdapter?void this.init():new n.MockAdapter},n.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval(function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})},250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new n.Receiver;t.on("play",function(){var r=this;e.play(),this.emit("play"),e.timeupdate=function(i){r.emit("timeupdate",i)}}),t.on("pause",function(){e.pause(),this.emit("pause")}),t.on("getPaused",function(r){r(!e.playing)}),t.on("getCurrentTime",function(r){r(e.currentTime)}),t.on("setCurrentTime",function(r){e.currentTime=r}),t.on("getDuration",function(r){r(e.duration)}),t.on("getVolume",function(r){r(e.volume)}),t.on("setVolume",function(r){e.volume=r}),t.on("mute",function(){e.mute=!0}),t.on("unmute",function(){e.mute=!1}),t.on("getMuted",function(r){r(e.mute)}),t.on("getLoop",function(r){r(e.loop)}),t.on("setLoop",function(r){e.loop=r})},n.MockAdapter.prototype.ready=function(){this.receiver.ready()},n.VideoJSAdapter=function(e){return this instanceof n.VideoJSAdapter?void this.init(e):new n.VideoJSAdapter(e)},n.VideoJSAdapter.prototype.init=function(e){n.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new n.Receiver;e.on("pause",function(){t.emit("pause")}),e.on("play",function(){t.emit("play")}),e.on("timeupdate",function(r){var i=e.currentTime(),o=e.duration();if(!i||!o)return!1;var s={seconds:i,duration:o};t.emit("timeupdate",s)}),e.on("ended",function(){t.emit("ended")}),e.on("error",function(){t.emit("error")}),t.on("play",function(){e.play()}),t.on("pause",function(){e.pause()}),t.on("getPaused",function(r){r(e.paused())}),t.on("getCurrentTime",function(r){r(e.currentTime())}),t.on("setCurrentTime",function(r){e.currentTime(r)}),t.on("getDuration",function(r){r(e.duration())}),t.on("getVolume",function(r){r(100*e.volume())}),t.on("setVolume",function(r){e.volume(r/100)}),t.on("mute",function(){e.volume(0)}),t.on("unmute",function(){e.volume(1)}),t.on("getMuted",function(r){r(e.volume()===0)}),t.on("getLoop",function(r){r(e.loop())}),t.on("setLoop",function(r){e.loop(r)})},n.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},typeof define=="function"&&define.amd?define(function(){return n}):typeof module=="object"&&module.exports?module.exports=n:u.playerjs=n})(window,document);
