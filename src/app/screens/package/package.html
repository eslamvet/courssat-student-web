@let package = packageSignal();
<section class="container pt-7 pb-10 lg:pt-10 lg:pb-16">
  <div class="bg-base-200 rounded-sm py-6 px-4 lg:px-8 mb-8 lg:mb-12">
    <div class="flex flex-wrap gap-4 lg:gap-6">
      <div
        class="flex-1 lg:basis-1/4 lg:flex-none min-h-27 lg:min-h-54 bg-package-card p-5 lg:p-8.5"
      >
        @if(package.id){
        <div class="relative w-full h-full">
          <img [ngSrc]="package.imageUrl | imgUrl : 'package'" fill priority />
        </div>
        } @else {
        <div class="skeleton w-full h-full"></div>
        }
      </div>
      <div class="flex-1">
        <div class="flex flex-wrap justify-between items-center gap-3 mb-6">
          @if(package.id){
          <h2 class="lg:text-3xl order-2 lg:order-1 font-bold text-body-5">
            {{ package.packageName_AR }}
          </h2>
          <span
            class="badge order-1 lg:order-2 badge-sm lg:badge-lg min-w-16 lg:min-w-25 lg:h-9 rounded-full bg-base-300"
            >{{ package.departmentName ?? package.courses?.[0]?.departmentName }}</span
          >
          } @else {
          <div class="skeleton w-full lg:w-1/2 order-2 lg:order-1 h-7 lg:h-9"></div>
          <div class="skeleton order-1 lg:order-2 h-7 w-16 lg:w-25 lg:h-9 rounded-full"></div>
          }
        </div>
        @if(!isMobile){ @if(package.id){
        <p class="text-xl text-base-content">
          {{ package.packageDescription_AR }}
        </p>
        } @else{
        <div class="skeleton w-full h-6 mb-3"></div>
        <div class="skeleton w-full h-6 mb-3"></div>
        <div class="skeleton w-full h-6 mb-3"></div>
        <div class="skeleton w-1/2 h-6"></div>
        } }
      </div>
      @if(isMobile){ @if(package.id){
      <p class="text-xs basis-full text-base-content mb-3">
        {{ package.packageDescription_AR }}
      </p>
      }@else{
      <div class="w-full">
        <div class="skeleton w-full h-5 mb-2"></div>
        <div class="skeleton w-full h-5 mb-2"></div>
        <div class="skeleton w-full h-5 mb-2"></div>
        <div class="skeleton w-1/2 h-5 mb-3"></div>
      </div>
      } }
    </div>
    <div class="my-4 hidden lg:block border-b border-dashed border-custom-1"></div>
    <div class="flex flex-wrap gap-4">
      <div class="flex basis-full lg:basis-auto items-center gap-4">
        @if(package.id){
        <div class="flex items-center gap-1">
          <span
            class="iconify solar--stopwatch-play-broken text-base-content text-lg lg:text-2xl"
          ></span>
          <span class="text-xs lg:text-sm text-base-content">{{ package.courseCount }} كورس</span>
        </div>
        <div class="flex items-center gap-1">
          <span
            class="iconify solar--user-circle-broken text-lg lg:text-xl text-base-content"
          ></span>
          <h5 class="text-xs lg:text-sm text-base-content">
            {{ (package.firstName ?? package.courses?.[0]?.firstName) + ' ' + (package.familyName ?? package.courses?.[0]?.familyName) }}
          </h5>
        </div>
        } @else {
        <div class="skeleton flex-1 h-5 lg:h-7"></div>
        <div class="skeleton flex-1 h-5 lg:h-7"></div>
        }
      </div>
      <div class="flex-1 flex lg:justify-end gap-2 lg:gap-4">
        @if(package.id){
        <button
          class="flex-1 lg:flex-none btn btn-base lg:btn-lg lg:text-base bg-base-500 text-primary rounded-xs border-primary border-dashed px-1 lg:px-12"
          (click)="addToCartHandler()"
        >
          إضافة لسلة المشتريات
        </button>
        <button
          class="flex-1 lg:flex-none btn btn-base lg:btn-lg lg:text-base rounded-xs btn-primary px-1 lg:px-12"
          (click)="purchasePackageHandler()"
        >
          <span>إشترك الآن</span
          ><span class="text-secondary">{{
            (package.discountPrice! || package.originalPrice!) * currency.value | number : '1.0-0'
          }}</span>
          <span
            class="text-secondary"
            [class]="{ 'font-saudi-riyal': isSaudi, 'text-2xl': isSaudi }"
            >{{ currency.code }}</span
          >
          @if(!isMobile && package.discountPrice! < package.originalPrice!){
          <span class="text-base-content line-through"
            >{{ package.originalPrice! * currency.value | number : '1.0-0'
            }}<span
              class="text-base-content line-through"
              [class]="{ 'font-saudi-riyal': isSaudi, 'text-2xl': isSaudi }"
              >{{ currency.code }}</span
            ></span
          >
          }
        </button>
        } @else {
        <div class="skeleton flex-1 h-10 lg:flex-none lg:w-40 lg:h-12.5"></div>
        <div class="skeleton flex-1 h-10 lg:flex-none lg:w-50 lg:h-12.5"></div>
        }
      </div>
    </div>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-2.5 lg:gap-5">
    @for(course of package.courses;track $index){
    <app-course-card [course]="course" />
    } @empty {
    <div role="alert" class="col-span-4 alert alert-info justify-center alert-soft">
      <span>لا توجد كورسات حالياً.</span>
    </div>
    }
  </div>
</section>
@if(package.id){
<dialog id="courssat_checkout_modal" class="modal">
  <div class="modal-box max-w-3xl max-h-9/10">
    <app-payment-methods
      [courses]="courseArr()"
      [totalValue]="package.discountPrice!"
      [totalOriginalValue]="(package.originalPrice || package.discountPrice)!"
      customPaymentBtnClass="w-full"
    />
    <div class="modal-action justify-stretch sticky bottom-0">
      <form method="dialog" class="flex-1">
        <button class="btn btn-lg btn-ghost w-full">الغاء</button>
      </form>
    </div>
  </div>
</dialog>
}
