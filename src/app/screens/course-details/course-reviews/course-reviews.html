<section>
  @let reviews = courseReviews();
  <div
    id="course-reviews-wrapper"
    class="flex flex-col gap-6 mb-6 overflow-y-auto overflow-x-hidden"
    [class.h-125]="reviews && reviews.length > 1"
    (scroll)="loadMoreReviews($event)"
  >
    @for(review of reviews;track $index){ @if(review){
    <div class="bg-base-200 rounded-sm px-4 lg:px-8 py-5 lg:py-6 flex gap-4 lg:gap-8">
      <img
        [src]="
          review.imageURL.startsWith('https')
            ? review.imageURL
            : (review.imageURL! | imgUrl : 'avatar')
        "
        class="w-9 h-9 lg:w-16 lg:h-16 rounded-full"
      />
      <div class="flex-1">
        <div class="flex justify-between mb-4">
          <div>
            <h4 class="text-sm lg:text-xl text-body-5">{{ review.firstName }}</h4>
            <img class="inline-block me-3" src="/images/star.svg" />
            <span class="align-sub text-base-content">{{ review.isLike ? '5' : '3' }}</span>
          </div>
          <div class="text-xs lg:text-lg text-base-content">
            {{ review.date | date : 'shortDate' }}
          </div>
        </div>
        <p class="text-xs lg:text-lg text-base-content mb-2">
          {{ review.evaluationComment }}
        </p>
        <button class="lg:text-lg underline text-secondary cursor-pointer">رد</button>
      </div>
    </div>
    } @else {
    <div class="flex gap-4 lg:gap-8">
      <div class="skeleton w-9 h-9 lg:w-16 lg:h-16 rounded-full"></div>
      <div class="flex-1">
        <div class="flex justify-between mb-4 lg:mb-6">
          <div class="skeleton w-1/3 h-6 lg:h-8"></div>
          <div class="skeleton w-1/4 h-5 lg:h-7"></div>
        </div>
        <div class="skeleton w-full h-5 lg:h-7 mb-3"></div>
        <div class="skeleton w-2/3 h-5 lg:h-7 mb-"></div>
      </div>
    </div>
    } } @empty {
    <div role="alert" class="alert justify-center alert-info alert-soft">
      <span>لا توجد تقييمات حتي الان لهذا الكورس</span>
    </div>
    }
  </div>
  @if(user && isPaid()){
  <form
    [formGroup]="reviewForm"
    class="bg-base-200 rounded-sm px-8 py-6 flex flex-col items-center"
    (ngSubmit)="addCourseReviewHandler()"
  >
    <div
      class="rating rating-xl"
      (click)="isLikeReviewFormControl?.setValue(!isLikeReviewFormControl?.value)"
    >
      <input
        type="radio"
        class="mask mask-star-2 bg-orange-400"
        aria-label="1 star"
        [checked]="!!this.isLikeReviewFormControl?.value"
      />
      <input
        type="radio"
        class="mask mask-star-2 bg-orange-400"
        aria-label="2 star"
        [checked]="!!this.isLikeReviewFormControl?.value"
      />
      <input
        type="radio"
        class="mask mask-star-2 bg-orange-400"
        aria-label="3 star"
        [checked]="!!this.isLikeReviewFormControl?.value"
      />
      <input
        type="radio"
        class="mask mask-star-2 bg-orange-400"
        aria-label="4 star"
        [checked]="!!this.isLikeReviewFormControl?.value"
      />
      <input
        type="radio"
        class="mask mask-star-2 bg-orange-400"
        aria-label="5 star"
        [checked]="!!this.isLikeReviewFormControl?.value"
      />
    </div>
    <div class="divider"></div>
    <div class="self-stretch flex gap-4 mb-5">
      <img class="w-16 h-16 rounded-full" src="/images/profile.png" />
      <div class="flex-1">
        <textarea
          class="textarea textarea-ghost w-full validator"
          required
          placeholder="اكتب تقييماً هنا ..."
          formControlName="evaluationComment"
          rows="3"
        ></textarea>
        <div class="validator-hint">التقييم مطلوب</div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary px-6">
      <span>حفظ</span>
      @if(loading()){
      <span class="loading loading-ring text-white"></span>
      }
    </button>
  </form>
  }
</section>
