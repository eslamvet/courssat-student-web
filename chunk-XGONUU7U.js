import{a as _}from"./chunk-VEPGRMJ6.js";import{a as T}from"./chunk-ZEXK2GDE.js";import"./chunk-6YXCTPXV.js";import{a as w,b as s,c as k,d as N,e as D,f as d,g as L,j as E,k as P,m as U,o as q}from"./chunk-HTAF2IZD.js";import"./chunk-P6OX5KW3.js";import"./chunk-V6UCKFY6.js";import"./chunk-5YZHE3HT.js";import{h as C}from"./chunk-AZGJ3U7A.js";import"./chunk-Q23L6LWU.js";import{J as g,Jb as v,Pa as f,Sa as o,Xb as u,Zb as A,a as p,ec as S,fb as b,fc as F,jb as h,qb as x,rb as y,ta as c,vb as l,wb as t,xb as i,yb as a}from"./chunk-ZPGQN5EY.js";function R(n,e){n&1&&a(0,"span",19)}var M=class n extends _{loginForm=new D({email:new d("",{nonNullable:!0,validators:[s.required,s.email]}),password:new d("",{nonNullable:!0,validators:[s.required]})});get emailControl(){return this.loginForm.get("email")}loginUserHandler(){if(this.loginForm.valid){if(this.loginMethod())return;this.loginMethod.set("normal"),this.authenticationService.login(this.loginForm.getRawValue()).pipe(g(()=>this.loginMethod.set(null))).subscribe({next:e=>{if(e.code===200){if(!e.user.isActive){this.toastService.addToast({id:Date.now(),type:"info",title:"\u062A\u0646\u0628\u064A\u0647",message:"\u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0645\u062A\u0648\u0642\u0641 \u0628\u0631\u062C\u0627\u0621 \u0627\u0644\u062A\u0648\u0627\u0635\u0644 \u0645\u0639 \u0627\u0644\u0627\u062F\u0627\u0631\u0629"});return}localStorage.setItem("courssat-user-token",e.token),localStorage.setItem("courssat-user-id",e.user.id),this.userService.setUser(e.user),this.toastService.addToast({id:Date.now(),type:"success",title:"\u062A\u0645 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0628\u0646\u062C\u0627\u062D",message:`\u0645\u0631\u062D\u0628\u0627 ${e.user.firstName+(e.user.familyName&&e.user.firstName!==e.user.familyName)?" "+e.user.familyName:""}`}),this.routeQueryParams.redirectURL?this.router.navigateByUrl(this.routeQueryParams.redirectURL,p({replaceUrl:!0},this.routeQueryParams.applyCoupon&&{queryParams:{applyCoupon:this.routeQueryParams.applyCoupon}})):this.router.navigateByUrl("/",{replaceUrl:!0})}else this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message_AR??"\u0641\u0634\u0644 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644\u060C \u064A\u0631\u062C\u0649 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629 \u0645\u0631\u0629 \u0623\u062E\u0631\u0649"})},error:e=>{this.toastService.addToast({id:Date.now(),type:"error",title:"\u062D\u062F\u062B \u062E\u0637\u0627 \u0645\u0627",message:e.message})}})}else this.loginForm.markAllAsTouched()}static \u0275fac=(()=>{let e;return function(r){return(e||(e=c(n)))(r||n)}})();static \u0275cmp=b({type:n,selectors:[["app-login"]],hostAttrs:[1,"basis-full","lg:basis-1/2"],features:[F([T]),h],decls:36,vars:7,consts:[[1,"flex","flex-col","gap-6","bg-custom-background-1","pt-10","pb-6","lg:py-16","px-4","lg:px-10","xl:px-16","2xl:px-23"],[1,"self-center","w-29","h-3.5","lg:w-auto","lg:h-auto",3,"src"],["id","googleBtn"],[1,"border-t","border-dashed","border-t-base-content"],[1,"flex","flex-col","gap-4","lg:gap-6",3,"ngSubmit","formGroup"],["for","user-email",1,"text-sm","lg:text-base","text-body-5","block","mb-2"],[1,"w-full","input","input-lg","validator","bg-base-600"],["formControlName","email","id","user-email","type","email","required","",1,"text-right"],[1,"iconify","ic--outline-email","text-2xl","text-base-content"],[1,"validator-hint","hidden"],["for","user-password",1,"text-sm","lg:text-base","text-body-5","block","mb-2"],["formControlName","password","id","user-password","type","password","required","",1,"text-right"],[1,"iconify","ic--lock-outline","text-2xl","text-base-content"],[1,"flex","justify-between","mb-4"],[1,"label","gap-2","text-sm"],["type","checkbox","checked","checked",1,"checkbox","rounded-sm","bg-base-600","checked:bg-base-600","checked:shadow-none"],["routerLink","/auth/forget-password",1,"btn","btn-link","text-xs","lg:text-sm","text-neutral-content","no-underline"],[1,"flex","items-center","flex-col","lg:flex-row","gap-4","lg:gap-6"],["type","submit",1,"w-1/2","btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner"],[1,"text-sm","text-neutral-content"],["routerLink","/auth/signup",1,"btn","btn-link","px-0","text-primary","dark:text-base-content",3,"queryParams"]],template:function(m,r){m&1&&(t(0,"section",0),a(1,"img",1)(2,"div",2)(3,"div",3),t(4,"form",4),v("ngSubmit",function(){return r.loginUserHandler()}),t(5,"div")(6,"label",5),u(7,"\u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0627\u0644\u0643\u062A\u0631\u0648\u0646\u064A"),i(),t(8,"div",6),a(9,"input",7)(10,"span",8),i(),t(11,"div",9),u(12),i()(),t(13,"div")(14,"label",10),u(15,"\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631"),i(),t(16,"div",6),a(17,"input",11)(18,"span",12),i(),t(19,"div",9),u(20,"\u0643\u0644\u0645\u0647 \u0627\u0644\u0645\u0631\u0648\u0631 \u0645\u0637\u0644\u0648\u0628\u0647"),i()(),t(21,"div",13)(22,"label",14),a(23,"input",15),u(24," \u062A\u0630\u0643\u0631\u0646\u064A "),i(),t(25,"a",16),u(26,"\u0647\u0644 \u0646\u0633\u064A\u062A \u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631\u061F"),i()(),t(27,"div",17)(28,"button",18)(29,"span"),u(30,"\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644"),i(),x(31,R,1,0,"span",19),i(),t(32,"p",20),u(33," \u0644\u064A\u0633 \u0644\u062F\u064A\u0643 \u062D\u0633\u0627\u0628\u061F "),t(34,"a",21),u(35,"\u062A\u0633\u062C\u064A\u0644 \u062C\u062F\u064A\u062F"),i()()()()()),m&2&&(o(),l("src",S("images/logo-",r.currentTheme(),".svg"),f),o(3),l("formGroup",r.loginForm),o(8),A(" ",!(r.emailControl==null||r.emailControl.errors==null)&&r.emailControl.errors.required?"\u0627\u0644\u0627\u064A\u0645\u064A\u0644 \u0645\u0637\u0644\u0648\u0628":"\u0627\u0644\u0627\u064A\u0645\u064A\u0644 \u063A\u064A\u0631 \u0635\u062D\u064A\u062D"," "),o(16),l("disabled",r.loginMethod()),o(3),y(r.loginMethod()==="normal"?31:-1),o(3),l("queryParams",r.routeQueryParams))},dependencies:[C,q,L,w,k,N,U,E,P],encapsulation:2})};export{M as Login};
